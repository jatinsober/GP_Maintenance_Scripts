------
--DEV BY : Jitendra Lodwal  
--DATE  : 25-AUG-2011 
--DESC : FUNCTION
------
------
--DEV BY : Jitendra Lodwal  
--DATE  : 05-NOV-2011 
--DESC : FUNCTION_CODE_CORRECTION
------

SET SEARCH_PATH TO WORKAREA;

CREATE OR REPLACE FUNCTION Mep_Main_Reportload_Als() RETURNS VOID AS $$
DECLARE
BEGIN


INSERT INTO MEP_LOG_ALS (ML_PROCESS_NAME,ML_RUN_START )
VALUES  ('PROGRAM TO INSERT DATA FROM MEP_DTL_ALS TO MEP_DTL_ALS_REPORT-SART',TO_CHAR(LOCALTIMESTAMP, 'DD-MON-YYYY HH:MI:SS') );

--TRUNCATE TABLE MEP_DTL_ALS_REPORT;


INSERT INTO MEP_DTL_FINAL_REPORT(
ACCT_NO,REP_MTH,SRC_SYS_CD,SEM_PROD_TYP,ACCT_OPEN_DT,PROD_TYPE,
ACCT_STATUS,NON_ACCRUAL,CYCLE,BLOCK_CD,CREDIT_LIMIT,MOB,APR,INDUSTRY,
OVERLIMIT_AMT,PERC_OVERLIMIT,WRITTEN_OFF,PRIN_AMT,INT_AMT,
LOAN_OPEN_DT,LOAN_PURPOSE,INT_RATE,INSTALL_AMT,LOAN_SUB_PROD,PAID_TODATE,
INSTALL_IND,PAYMENT_TYPE,LAST_AMT_PAID,LAST_PAY_DT,SEC_IND,
LOAN_AGE,
TERM,INT_REPAYMENT,
--INSTALL_AMT,
REMAIN_PRIN_AMT,
--PAID_AMT,
BAL_AMT,REMAIN_TERM,
INT_ONLY,PRIN_REPAYMENT,AMT_IN_ARREARS,DELINQ_BUCKET,INSURANCE,AUTO_DEBIT,
CO_DELINQ_MTH,PREV_DELINQ,CURRENT_AMT,ACTIVE,
--NET_CREDIT_LOSS,
PAYMENT_RATE,
AVER_NET_RECEIVABLE,AKPK,ASSET_POSSESSION,ASSET_SALE_PRICE,ASSET_SALE_DT,ASSET_TYPE,
WATCHLIST_FLAG,IND_IMPAIRED,COLL_VALUE,ONSELLING_AMT,ONSELLING_DT,
GROSS_WRITTEN_OFF,CLOSED,DEMOGRAPHIC,FEES,PAYMENT,MEP_PROD_TYP,RECOVERY,REMAIN_INT_AMT)


SELECT
DISTINCT MD_ACCT_NO,MD_REPORT_DT,MD_APPL_SYS_ID,'HL' AS SEM_PROD_TYP,MD_ACCT_OPEN_DT,MD_PROD_CD,MD_ACCT_STAT,
MD_NON_ACCRUAL AS NON_ACCRUAL,
MD_CYCLE,MD_BLOCK_CD,MD_CRDT_LMT,MD_MTH_ON_BOOK,MD_APR,MD_INDUSTRY,MD_OVER_LMT_AMT,MD_OVER_LMT_PCT,MD_WOFF_IND,
MD_PRINC_LN_AMT,MD_INT_AMT,MD_LN_OPEN_DT,MD_LN_PURPOSE,MD_INT_RT,MD_MTH_AMORT,MD_LN_SUB_PROD,MD_PAID_PCT,MD_INSTALL_IND,
MD_PYMT_TYP,MD_LST_PYMT_AMT,MD_LST_PYMT_DT,NULL MD_SEC_IND,
CAST(SUBSTR(MD_LN_AGE,1,3) AS NUMERIC),

CAST(MD_LN_TERM AS NUMERIC),
MD_TOT_INT_PAID,MD_PRINC_REMAIN_AMT,
--MD_TOT_PRINC_PAID,
MD_OS_AMT,MD_REMAIN_TERMS,
MD_INT_ONLY,MD_TOT_PRINC_PAID,
MD_DELI_AMT,MD_PAST_DUE,MD_INSURANCE,
MD_AUTO_DBT_IND,MD_COINDC_DELI_ME,MD_PREV_DELI,MD_AMT_DUE,MD_ACTIVE_IND,
--MD_NET_CRDT_LOSS,
COALESCE(MD_PYMT_RT),
MD_NET_RECEIVE_AVG,MD_AKPK,MD_ASSET_POSSESSION AS ASSET_POSSESION,
MD_ASSET_SALE_PRICE,MD_ASSET_SALE_DT,MD_ASSET_TYPE,MD_WATCHLIST_FLAG  AS WATCHLIST_FLAG ,
MD_IND_IMPAIRED AS IND_IMPAIRED,MD_COLLAT_VALUE,MD_ONSELLING_AMT,
MD_ONSELLING_DT,MD_GS_WOFF_AMT,MD_CLOSED,MD_DEMOGRPH_INFO,MD_FEE,MD_PAYMENT,'HL' AS MEP_PROD_TYP,
MD_RECOVERY_AMT,MD_INT_REMAIN_AMT
FROM MEP_DTL_ALS;
--COMMIT;

INSERT INTO MEP_LOG_ALS (ML_PROCESS_NAME,ML_RUN_START )
VALUES  ('PROGRAM TO INSERT DATA FROM MEP_DTL_ALS TO MEP_DTL_ALS_REPORT-END',TO_CHAR(LOCALTIMESTAMP, 'DD-MON-YYYY HH:MI:SS') );
--COMMIT;
END;
$$ 
LANGUAGE PLPGSQL;
