------
--DEV BY : Jitendra Lodwal  
--DATE  : 27-AUG-2011 
--DESC : FUNCTION
------

SET SEARCH_PATH TO WORKAREA;

CREATE OR REPLACE FUNCTION BSCORE_XTRACT_STS_CUST(CYC_DT IN DATE) RETURNS VOID AS $$
DECLARE

BEGIN

	TRUNCATE TABLE BSCORE_STS_CUST;
	--COMMIT;

	INSERT INTO BSCORE_PROC_LOG(SYS_ID, BUS_CYC_DT, PROCESS_MSG, PROC_DT)
	VALUES ('STS', CYC_DT, 'START INSERT BSCORE_STS_CUST', LOCALTIMESTAMP);
	--COMMIT;

	INSERT INTO BSCORE_STS_CUST(BUS_CYC_DT, ACCT_NO, CUST_ID, REL_TYP_CD, PRIME_NO)
	SELECT CYC_DT, CAR_A_ACCT_NO, CAR_PRIMARY_ID, CAR_REL_TYP_CD, CAR_PRIME_NO
	FROM DWPROD.CUST_ACCT_REL_HT
	WHERE CAR_BUS_CYC_DT = CYC_DT
	AND CAR_A_APPL_SYS_ID = 'STS'
	AND SUBSTR(CAR_A_ACCT_NO,9,3) IN ('001','007','008','002','009');
	--COMMIT;

	INSERT INTO BSCORE_PROC_LOG(SYS_ID, BUS_CYC_DT, PROCESS_MSG, PROC_DT)
	VALUES ('STS', CYC_DT, 'END INSERT BSCORE_STS_CUST', LOCALTIMESTAMP);
	--COMMIT;

END;
$$
LANGUAGE PLPGSQL;

