------
--DEV BY : Jitendra Lodwal  
--DATE  : 27-AUG-2011 
--DESC : FUNCTION
------

SET SEARCH_PATH TO WORKAREA;
CREATE OR REPLACE FUNCTION BSCORE_XTRACT_IMS_CUST(RUN_DATE IN DATE) RETURNS VOID AS $$
DECLARE

	 PROC_DT2 DATE;

BEGIN

	 PROC_DT2 := RUN_DATE;
	 TRUNCATE TABLE BSCORE_IMS_CUST;
	 
	 INSERT INTO BSCORE_LOG_IMS(SYS_ID, BUS_CYC_DT, PROCESS_MSG, PROC_DT)
	 VALUES ('IMS', RUN_DATE, 'START INSERT BSCORE_IMS_CUST', LOCALTIMESTAMP);
	 --COMMIT;

INSERT INTO BSCORE_IMS_CUST(BUS_CYC_DT, ACCT_NO, PRIMARY_ID, REL_TYP_CD, PRIME_NO)

SELECT PROC_DT2, CAR_A_ACCT_NO, CAR_PRIMARY_ID,  CAR_REL_TYP_CD, CAR_PRIME_NO
FROM dwprod.cust_acct_rel_ht_1_prt_cust_acct_rel_ht_201102
where CAR_A_APPL_SYS_ID ='IMS'
and car_BUS_CYC_DT = PROC_DT2;

--commit;

INSERT INTO BSCORE_LOG_IMS(SYS_ID, BUS_CYC_DT, PROCESS_MSG, PROC_DT)
	 VALUES ('IMS', RUN_DATE, 'END INSERT BSCORE_IMS_CUST', LOCALTIMESTAMP);
	 --COMMIT;

END;
$$
LANGUAGE PLPGSQL;

