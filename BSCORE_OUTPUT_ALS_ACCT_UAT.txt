------
--DEV BY : Jitendra Lodwal  
--DATE  : 10-Sep-2011 
--DESC : FUNCTION
------

SET SEARCH_PATH TO WORKAREA;

CREATE OR REPLACE FUNCTION BSCORE_OUTPUT_ALS_ACCT_UAT(inout PROC_DT DATE) RETURNS DATE AS $body$


DECLARE
CNT NUMERIC(25);
TOTAL NUMERIC(25,2);
FILE1 TEXT;
FILE2 TEXT;

BEGIN

	SELECT COUNT(ACCT_NO) INTO CNT FROM BSCORE_ALS_ACCT_UAT;
	SELECT SUM(CYC_BAL_VAL_WITH_EPP) INTO TOTAL FROM BSCORE_ALS_ACCT_UAT;

	FILE1 := $$/home/gpadmin/PIDM_DIR/HBSCORE_ALS_ACCT_$$ || TO_CHAR(PROC_DT,'YYYYMMDD') || '.txt';

CREATE TEMP TABLE MCD_OUTPUT_F1
(R_ORDER NUMERIC
, COL_1 VARCHAR(50) NULL
, COL_2 VARCHAR(50) NULL
, COL_3 VARCHAR(50) NULL)
;

INSERT INTO MCD_OUTPUT_F1 (R_ORDER, COL_1, COL_2, COL_3) VALUES (1,'BUSINESS_DATE','RECORD_COUNT','HASH_TOTAL');

INSERT INTO MCD_OUTPUT_F1 (R_ORDER, COL_1, COL_2, COL_3) VALUES (2,TO_CHAR(PROC_DT,'YYYYMMDD'),LPAD(CNT,10,'0'),TRIM(TO_CHAR(TOTAL,'099999999999999999999.99')));
	

EXECUTE 'copy (select COL_1,COL_2,COL_3 from MCD_OUTPUT_F1 order by R_ORDER) to  ''' || FILE1 || ''';';

	FILE2 := $$/home/gpadmin/PIDM_DIR/BSCORE_ALS_ACCT_$$ || TO_CHAR(PROC_DT,'YYYYMMDD') || '.txt';


CREATE TEMP TABLE MCD_OUTPUT_F2 (R_ORDER NUMERIC, ACCT_NO VARCHAR, CUST_ID VARCHAR, HIGHEST_CUR_DELINQ VARCHAR, HIGHEST_30DAY_DELINQ VARCHAR, HIGHEST_60DAY_DELINQ VARCHAR,HIGHEST_90DAY_DELINQ VARCHAR, HIGHEST_120DAY_DELINQ VARCHAR, HIGHEST_150DAY_DELINQ VARCHAR, HIGHEST_180DAY_DELINQ VARCHAR,HIGHEST_210DAY_DELINQ VARCHAR, HIGHEST_240DAY_DELINQ VARCHAR, HIGHEST_270DAY_DELINQ VARCHAR, HIGHEST_300DAY_DELINQ VARCHAR,HIGHEST_330DAY_DELINQ VARCHAR, HIGHEST_360DAY_DELINQ VARCHAR, HIGHEST_390DAY_DELINQ VARCHAR, HIGHEST_DELINQ_VAL VARCHAR,HIGHEST_BAL_VAL VARCHAR, ACCT_STAT VARCHAR, ACC_REC_AMT VARCHAR, BANKRUPT_DT VARCHAR, BANKRUPT_FLG VARCHAR, BANKRUPT_VAL VARCHAR, CARD_TYP VARCHAR,CHARGE_OFF_DT VARCHAR, CHARGE_OFF_FLG VARCHAR, CHARGE_OFF_VAL VARCHAR, CYC_ARR_FEE_VAL VARCHAR, CYC_ARR_INT_VAL VARCHAR, CYC_ARR_VAL VARCHAR,CYC_BAL_VAL_WITH_EPP VARCHAR, CYC_CASH_ADV_CNT VARCHAR, CYC_CASH_ADV_VAL VARCHAR, CYC_CASH_ADV_LMT VARCHAR, CYC_CR_VAL VARCHAR, CYC_DB_VAL VARCHAR,CYC_MERCH_PURC_CNT VARCHAR, CYC_MERCH_PURCH_VAL VARCHAR, CYC_PYMT_VAL VARCHAR, CYC_DT VARCHAR, CYC_MIN_PYMT_VAL VARCHAR, CYC_PAST_DUE_VAL VARCHAR,CLOSED_DT VARCHAR, CARD_EXPY_DT VARCHAR, FST_CASH_ADV_DT VARCHAR, FST_MERCH_PURC_DT VARCHAR, LST_CASH_ADV_DT VARCHAR, LST_DEFAULT_DT VARCHAR,LST_COL_DT VARCHAR, LST_CR_DT VARCHAR, LST_TOT_ARR_VAL_DT VARCHAR, LST_WOFF_DT VARCHAR, LST_MAINTAIN_ACCT_STAT_DT VARCHAR,LST_MERCH_PURC_DT VARCHAR, LST_OUT_DEFAULT_DT VARCHAR, LST_PYMT_DT VARCHAR, START_OVERLMT_DT VARCHAR, DEFAULT_AMT VARCHAR, DEFAULT_FLG VARCHAR,DEFAULT_REASON VARCHAR, EXT_COL_DT VARCHAR, EXT_COL_FLG VARCHAR, EXT_COL_VAL VARCHAR, FRAUD_DT VARCHAR, FRAUD_FLG VARCHAR, FRAUD_VAL VARCHAR, INT_RATE VARCHAR,INVOLUNTARY_CL_DT VARCHAR, INVOLUNTARY_CL_FLG VARCHAR, INVOLUNTARY_CL_VAL VARCHAR, LEGAL_ACT_VALUE VARCHAR, LEGAL_DT VARCHAR, LEGAL_FLG VARCHAR,LEGAL_STAT VARCHAR, LEGAL_VAL VARCHAR, CYC_INT_VAL VARCHAR, CYC_INT_DUE VARCHAR, NATIONALITY VARCHAR, RETURN_PYMT_CNT VARCHAR, OD_LMT VARCHAR,ONSELLING_DT VARCHAR, ONSELLING_AMT VARCHAR, ONSELLING_PYMT_AMT VARCHAR, ONSELLING_REC VARCHAR, REC_SRC_CD VARCHAR,REC_PRIN_AMT VARCHAR, REC_INT_AMT VARCHAR, REC_COST_AMT VARCHAR, REC_TOT_AMT VARCHAR, PYMT_METHOD VARCHAR, PLASTIC_STAT VARCHAR,POSTING_CD VARCHAR, PREV_ACCT_STAT VARCHAR, PROD_CAT VARCHAR, PROD_CD VARCHAR, REASON_CL VARCHAR, REC_AMT VARCHAR, REC_DT VARCHAR, REMINDER VARCHAR, REPYMT_AGR VARCHAR,RESTRU_DT VARCHAR, RESTRU_FLG VARCHAR, RESTRU_VAL VARCHAR, RESTRU_AGR VARCHAR, RETURN_STAND_INSTR_IND VARCHAR, STAT_CHG_DT VARCHAR, PAY_PROMISE_CNT VARCHAR,PAY_PROMISE_CNT_BROKEN VARCHAR, TRAN_AMT VARCHAR, TRAN_SEQ_NO VARCHAR, TRAN_CD VARCHAR, TRAN_SYS_CD VARCHAR, TRAN_DT VARCHAR, TRAN_POST_DT VARCHAR,USER_CD_1 VARCHAR, USER_CD_2 VARCHAR, USER_CD_3 VARCHAR, USER_CD_4 VARCHAR, WOFF_VAL VARCHAR, HIGHEST_ARR_PYMT VARCHAR, ACCT_CD VARCHAR, ACCT_PRD_SER_CD VARCHAR,ACCT_STAT_2 VARCHAR, ACCT_STAT_3 VARCHAR, ACCT_TYP VARCHAR, ACC_INT VARCHAR, AGENT_CD VARCHAR, AUTHORISE_LMT VARCHAR, BILL_DT VARCHAR, BUS_ACT VARCHAR, CAMPAIGN_CD VARCHAR,CHQ_RETURN_IND VARCHAR, CHQ_RETURN_AMT VARCHAR, COLL_APPR_VAL VARCHAR, COLL_SALE_VAL VARCHAR, CONST_CD VARCHAR, CYC_ARR_COMM_VAL VARCHAR, CYC_ARR_PEN_VAL VARCHAR,CYC_ARR_PRIN_VAL VARCHAR, CYC_AVAIL_BAL_VAL VARCHAR, CYC_DY VARCHAR, CYC_LATE_CHARG_VAL VARCHAR, CYC_MISC_CHARG_VAL VARCHAR, CYC_WITHDRAW_LMT VARCHAR,CYC_LED_BAL_VAL VARCHAR, FINAL_PYMT_DT VARCHAR, LST_CR_TXN_DT VARCHAR, LST_DR_TXN_DT VARCHAR, LST_TXN_DT VARCHAR, OVERLMT_DT VARCHAR, FAC_CD VARCHAR,FAC_TYP VARCHAR, INSTALL_AMT VARCHAR, INSURE_OS_IND VARCHAR, LEGAL_ACT_DT VARCHAR, LEGAL_ACT_FLG VARCHAR, LOAN_TYP VARCHAR, PURPOSES VARCHAR, MAT_DT VARCHAR,ME_INSTALL_ARR_AMT VARCHAR, CYC_CR_CNT VARCHAR, CYC_CR_VAL_CA VARCHAR, CYC_DR_CNT VARCHAR, CYC_DR_VAL_CA VARCHAR, CYC_PRIN_BALOS VARCHAR, MRTA_IND VARCHAR,APPLICANT_CNT VARCHAR, GUARANTOR_CNT VARCHAR, OFFICER_CD VARCHAR, PROD_GRP VARCHAR, PROD_ORIG_BRN VARCHAR, PROD_SCH_TYP VARCHAR, PROD_TYP_DESC VARCHAR,PURPOSE_CD VARCHAR, REPYMT_PERIOD VARCHAR, RESTRU_PERIOD VARCHAR, RESCHE_FLG VARCHAR, SALARY_IND VARCHAR, SECTOR_CD VARCHAR, SETTLE_DT VARCHAR, SRC_CD VARCHAR,STANDING_INSTR_AMT VARCHAR, STANDING_INSTR_IND VARCHAR, SUB_TYP VARCHAR, TOT_OD_DRAWDOWN_AMT VARCHAR, SUB_PURPOSE VARCHAR, MAIN_TYP VARCHAR,TXN_DESC VARCHAR, CYC_BAL_VAL_WITHO_EPP VARCHAR, UNBILL_EPP VARCHAR, EPP_1ST_INSTALL_AMT VARCHAR, CR_LMT VARCHAR, COLL_VAL VARCHAR,DELINQ_BUCKET VARCHAR, OPEN_DT VARCHAR, MTD_LOWEST_BAL_AMT VARCHAR, MTD_TOT_BAL_AMT VARCHAR, MTD_TOT_DAYS VARCHAR, MTD_WITHDRAW_CNT VARCHAR,MTD_WITHDRAW_AMT VARCHAR, MTD_DEP_CNT VARCHAR, MTD_DEP_AMT VARCHAR, SAV_HOLD_FULL_AMT_IND VARCHAR, SAV_FLOAT_AMT VARCHAR, SAV_MIN_AMT VARCHAR,SAV_HOLD_AMT VARCHAR, AKPK VARCHAR, GL_GRP_CD VARCHAR, SPEC_PROVISION VARCHAR, LOAN_GRP VARCHAR, RETAIL_OD VARCHAR, TERM VARCHAR, REPYMT_PRIN VARCHAR, REPYMT_INT VARCHAR,REPYMT_FEE VARCHAR, REPYMT_LPI VARCHAR, EXCESS_VAL VARCHAR, SME_TAG VARCHAR, IIS_LEGAL_ACTION_STATUS VARCHAR, CM_TOT_OUT_BAL VARCHAR, CM_PROC_STAT VARCHAR,ACCT_OVERDUE_AMT VARCHAR, ACCT_RESCHED_RESTRU_FLAG VARCHAR);

INSERT INTO MCD_OUTPUT_F2(
R_ORDER, ACCT_NO , CUST_ID , HIGHEST_CUR_DELINQ , HIGHEST_30DAY_DELINQ , HIGHEST_60DAY_DELINQ ,HIGHEST_90DAY_DELINQ , HIGHEST_120DAY_DELINQ , HIGHEST_150DAY_DELINQ , HIGHEST_180DAY_DELINQ ,HIGHEST_210DAY_DELINQ , HIGHEST_240DAY_DELINQ , HIGHEST_270DAY_DELINQ , HIGHEST_300DAY_DELINQ ,HIGHEST_330DAY_DELINQ , HIGHEST_360DAY_DELINQ , HIGHEST_390DAY_DELINQ , HIGHEST_DELINQ_VAL ,HIGHEST_BAL_VAL , ACCT_STAT , ACC_REC_AMT , BANKRUPT_DT , BANKRUPT_FLG , BANKRUPT_VAL , CARD_TYP ,CHARGE_OFF_DT , CHARGE_OFF_FLG , CHARGE_OFF_VAL , CYC_ARR_FEE_VAL , CYC_ARR_INT_VAL , CYC_ARR_VAL ,CYC_BAL_VAL_WITH_EPP , CYC_CASH_ADV_CNT , CYC_CASH_ADV_VAL , CYC_CASH_ADV_LMT , CYC_CR_VAL , CYC_DB_VAL ,CYC_MERCH_PURC_CNT , CYC_MERCH_PURCH_VAL , CYC_PYMT_VAL , CYC_DT , CYC_MIN_PYMT_VAL , CYC_PAST_DUE_VAL ,CLOSED_DT , CARD_EXPY_DT , FST_CASH_ADV_DT , FST_MERCH_PURC_DT , LST_CASH_ADV_DT , LST_DEFAULT_DT ,LST_COL_DT , LST_CR_DT , LST_TOT_ARR_VAL_DT , LST_WOFF_DT , LST_MAINTAIN_ACCT_STAT_DT ,LST_MERCH_PURC_DT , LST_OUT_DEFAULT_DT , LST_PYMT_DT , START_OVERLMT_DT , DEFAULT_AMT , DEFAULT_FLG ,DEFAULT_REASON , EXT_COL_DT , EXT_COL_FLG , EXT_COL_VAL , FRAUD_DT , FRAUD_FLG , FRAUD_VAL , INT_RATE ,INVOLUNTARY_CL_DT , INVOLUNTARY_CL_FLG , INVOLUNTARY_CL_VAL , LEGAL_ACT_VALUE , LEGAL_DT , LEGAL_FLG ,LEGAL_STAT , LEGAL_VAL , CYC_INT_VAL , CYC_INT_DUE , NATIONALITY , RETURN_PYMT_CNT , OD_LMT ,ONSELLING_DT , ONSELLING_AMT , ONSELLING_PYMT_AMT , ONSELLING_REC , REC_SRC_CD ,REC_PRIN_AMT , REC_INT_AMT , REC_COST_AMT , REC_TOT_AMT , PYMT_METHOD , PLASTIC_STAT ,POSTING_CD , PREV_ACCT_STAT , PROD_CAT , PROD_CD , REASON_CL , REC_AMT , REC_DT , REMINDER , REPYMT_AGR ,RESTRU_DT , RESTRU_FLG , RESTRU_VAL , RESTRU_AGR , RETURN_STAND_INSTR_IND , STAT_CHG_DT , PAY_PROMISE_CNT ,PAY_PROMISE_CNT_BROKEN , TRAN_AMT , TRAN_SEQ_NO , TRAN_CD , TRAN_SYS_CD , TRAN_DT , TRAN_POST_DT ,USER_CD_1 , USER_CD_2 , USER_CD_3 , USER_CD_4 , WOFF_VAL , HIGHEST_ARR_PYMT , ACCT_CD , ACCT_PRD_SER_CD ,ACCT_STAT_2 , ACCT_STAT_3 , ACCT_TYP , ACC_INT , AGENT_CD , AUTHORISE_LMT , BILL_DT , BUS_ACT , CAMPAIGN_CD , CHQ_RETURN_IND , CHQ_RETURN_AMT , COLL_APPR_VAL , COLL_SALE_VAL , CONST_CD , CYC_ARR_COMM_VAL , CYC_ARR_PEN_VAL , CYC_ARR_PRIN_VAL , CYC_AVAIL_BAL_VAL , CYC_DY , CYC_LATE_CHARG_VAL , CYC_MISC_CHARG_VAL , CYC_WITHDRAW_LMT , CYC_LED_BAL_VAL , FINAL_PYMT_DT , LST_CR_TXN_DT , LST_DR_TXN_DT , LST_TXN_DT , OVERLMT_DT , FAC_CD , FAC_TYP , INSTALL_AMT , INSURE_OS_IND , LEGAL_ACT_DT , LEGAL_ACT_FLG , LOAN_TYP , PURPOSES , MAT_DT , ME_INSTALL_ARR_AMT , CYC_CR_CNT , CYC_CR_VAL_CA , CYC_DR_CNT , CYC_DR_VAL_CA , CYC_PRIN_BALOS , MRTA_IND , 
APPLICANT_CNT , GUARANTOR_CNT , OFFICER_CD , PROD_GRP , PROD_ORIG_BRN , PROD_SCH_TYP , PROD_TYP_DESC , PURPOSE_CD , REPYMT_PERIOD , RESTRU_PERIOD , RESCHE_FLG , SALARY_IND , SECTOR_CD , SETTLE_DT , SRC_CD , STANDING_INSTR_AMT , STANDING_INSTR_IND , SUB_TYP , TOT_OD_DRAWDOWN_AMT , SUB_PURPOSE , MAIN_TYP , TXN_DESC , CYC_BAL_VAL_WITHO_EPP , UNBILL_EPP , EPP_1ST_INSTALL_AMT , CR_LMT , COLL_VAL , DELINQ_BUCKET , OPEN_DT , MTD_LOWEST_BAL_AMT , MTD_TOT_BAL_AMT , MTD_TOT_DAYS , MTD_WITHDRAW_CNT , MTD_WITHDRAW_AMT , MTD_DEP_CNT , MTD_DEP_AMT , SAV_HOLD_FULL_AMT_IND , SAV_FLOAT_AMT , SAV_MIN_AMT , SAV_HOLD_AMT , AKPK , GL_GRP_CD , SPEC_PROVISION , LOAN_GRP , RETAIL_OD , TERM , REPYMT_PRIN , REPYMT_INT , REPYMT_FEE , REPYMT_LPI , EXCESS_VAL , SME_TAG , IIS_LEGAL_ACTION_STATUS , CM_TOT_OUT_BAL , CM_PROC_STAT , ACCT_OVERDUE_AMT , ACCT_RESCHED_RESTRU_FLAG ) 
VALUES (1, 'ACCT_NO' , 'CUST_ID' , 'HIGHEST_CUR_DELINQ' , 'HIGHEST_30DAY_DELINQ' , 'HIGHEST_60DAY_DELINQ' ,'HIGHEST_90DAY_DELINQ' , 'HIGHEST_120DAY_DELINQ' , 'HIGHEST_150DAY_DELINQ' , 'HIGHEST_180DAY_DELINQ' ,'HIGHEST_210DAY_DELINQ' , 'HIGHEST_240DAY_DELINQ' , 'HIGHEST_270DAY_DELINQ' , 'HIGHEST_300DAY_DELINQ' ,'HIGHEST_330DAY_DELINQ' , 'HIGHEST_360DAY_DELINQ' , 'HIGHEST_390DAY_DELINQ' , 'HIGHEST_DELINQ_VAL' ,'HIGHEST_BAL_VAL' , 'ACCT_STAT' , 'ACC_REC_AMT' , 'BANKRUPT_DT' , 'BANKRUPT_FLG' , 'BANKRUPT_VAL' , 'CARD_TYP' ,'CHARGE_OFF_DT' , 'CHARGE_OFF_FLG' , 'CHARGE_OFF_VAL' , 'CYC_ARR_FEE_VAL' , 'CYC_ARR_INT_VAL' , 'CYC_ARR_VAL' ,'CYC_BAL_VAL_WITH_EPP' , 'CYC_CASH_ADV_CNT' , 'CYC_CASH_ADV_VAL' , 'CYC_CASH_ADV_LMT' , 'CYC_CR_VAL' , 'CYC_DB_VAL' ,'CYC_MERCH_PURC_CNT' , 'CYC_MERCH_PURCH_VAL' , 'CYC_PYMT_VAL' , 'CYC_DT' , 'CYC_MIN_PYMT_VAL' , 'CYC_PAST_DUE_VAL' ,'CLOSED_DT' , 'CARD_EXPY_DT' , 'FST_CASH_ADV_DT' , 'FST_MERCH_PURC_DT' , 'LST_CASH_ADV_DT' , 'LST_DEFAULT_DT' ,'LST_COL_DT' , 'LST_CR_DT' , 'LST_TOT_ARR_VAL_DT' , 'LST_WOFF_DT' , 'LST_MAINTAIN_ACCT_STAT_DT' ,'LST_MERCH_PURC_DT' , 'LST_OUT_DEFAULT_DT' , 'LST_PYMT_DT' , 'START_OVERLMT_DT' , 'DEFAULT_AMT' , 'DEFAULT_FLG' ,'DEFAULT_REASON' , 'EXT_COL_DT' , 'EXT_COL_FLG' , 'EXT_COL_VAL', 'FRAUD_DT' , 'FRAUD_FLG' , 'FRAUD_VAL' , 'INT_RATE' ,'INVOLUNTARY_CL_DT' , 'INVOLUNTARY_CL_FLG' , 'INVOLUNTARY_CL_VAL' , 'LEGAL_ACT_VALUE' , 'LEGAL_DT' , 'LEGAL_FLG' ,'LEGAL_STAT' , 'LEGAL_VAL' , 'CYC_INT_VAL' , 'CYC_INT_DUE' , 'NATIONALITY' , 'RETURN_PYMT_CNT' , 'OD_LMT' ,'ONSELLING_DT' , 'ONSELLING_AMT' , 'ONSELLING_PYMT_AMT' , 'ONSELLING_REC' , 'REC_SRC_CD' ,'REC_PRIN_AMT', 'REC_INT_AMT' , 'REC_COST_AMT' , 'REC_TOT_AMT' , 'PYMT_METHOD' , 'PLASTIC_STAT' ,'POSTING_CD' , 'PREV_ACCT_STAT' , 'PROD_CAT' , 'PROD_CD' , 'REASON_CL' , 'REC_AMT' , 'REC_DT' , 'REMINDER' , 'REPYMT_AGR' ,'RESTRU_DT' , 'RESTRU_FLG' , 'RESTRU_VAL' , 'RESTRU_AGR' , 'RETURN_STAND_INSTR_IND' , 'STAT_CHG_DT' , 'PAY_PROMISE_CNT' ,'PAY_PROMISE_CNT_BROKEN' , 'TRAN_AMT' , 'TRAN_SEQ_NO' , 'TRAN_CD' , 'TRAN_SYS_CD' , 'TRAN_DT' , 'TRAN_POST_DT' ,'USER_CD_1' , 'USER_CD_2' , 'USER_CD_3' , 'USER_CD_4' , 'WOFF_VAL' , 'HIGHEST_ARR_PYMT' , 'ACCT_CD' , 'ACCT_PRD_SER_CD' ,'ACCT_STAT_2' , 'ACCT_STAT_3' , 'ACCT_TYP' , 'ACC_INT' , 'AGENT_CD' , 'AUTHORISE_LMT' , 'BILL_DT' , 'BUS_ACT' , 'CAMPAIGN_CD' , 'CHQ_RETURN_IND' , 'CHQ_RETURN_AMT' , 'COLL_APPR_VAL' , 'COLL_SALE_VAL' , 'CONST_CD' , 'CYC_ARR_COMM_VAL' , 'CYC_ARR_PEN_VAL' , 'CYC_ARR_PRIN_VAL' , 'CYC_AVAIL_BAL_VAL' , 'CYC_DY' , 'CYC_LATE_CHARG_VAL' , 'CYC_MISC_CHARG_VAL' , 'CYC_WITHDRAW_LMT' , 'CYC_LED_BAL_VAL' , 'FINAL_PYMT_DT' , 'LST_CR_TXN_DT' , 'LST_DR_TXN_DT', 'LST_TXN_DT' , 'OVERLMT_DT' , 'FAC_CD' , 'FAC_TYP' , 'INSTALL_AMT' , 'INSURE_OS_IND' , 'LEGAL_ACT_DT' , 'LEGAL_ACT_FLG' , 'LOAN_TYP' , 'PURPOSES' , 'MAT_DT' , 'ME_INSTALL_ARR_AMT' , 'CYC_CR_CNT' , 'CYC_CR_VAL_CA' , 'CYC_DR_CNT' , 'CYC_DR_VAL_CA' , 'CYC_PRIN_BALOS' , 'MRTA_IND', 
'APPLICANT_CNT' , 'GUARANTOR_CNT' , 'OFFICER_CD' , 'PROD_GRP' , 'PROD_ORIG_BRN' , 'PROD_SCH_TYP' , 'PROD_TYP_DESC' , 'PURPOSE_CD', 'REPYMT_PERIOD' , 'RESTRU_PERIOD' , 'RESCHE_FLG' , 'SALARY_IND' , 'SECTOR_CD' , 'SETTLE_DT' , 'SRC_CD' , 'STANDING_INSTR_AMT' , 'STANDING_INSTR_IND' , 'SUB_TYP' , 'TOT_OD_DRAWDOWN_AMT' , 'SUB_PURPOSE' , 'MAIN_TYP' , 'TXN_DESC' , 'CYC_BAL_VAL_WITHO_EPP' , 'UNBILL_EPP' , 'EPP_1ST_INSTALL_AMT' , 'CR_LMT' , 'COLL_VAL' , 'DELINQ_BUCKET' , 'OPEN_DT' , 'MTD_LOWEST_BAL_AMT' , 'MTD_TOT_BAL_AMT' , 'MTD_TOT_DAYS' , 'MTD_WITHDRAW_CNT' , 'MTD_WITHDRAW_AMT' , 'MTD_DEP_CNT' , 'MTD_DEP_AMT' , 'SAV_HOLD_FULL_AMT_IND' , 'SAV_FLOAT_AMT' , 'SAV_MIN_AMT' , 'SAV_HOLD_AMT' , 'AKPK' , 'GL_GRP_CD' , 'SPEC_PROVISION' , 'LOAN_GRP' , 'RETAIL_OD' , 'TERM', 'REPYMT_PRIN' , 'REPYMT_INT' , 'REPYMT_FEE' , 'REPYMT_LPI' , 'EXCESS_VAL' , 'SME_TAG' , 'IIS_LEGAL_ACTION_STATUS' , 'CM_TOT_OUT_BAL' , 'CM_PROC_STAT' , 'ACCT_OVERDUE_AMT' , 'ACCT_RESCHED_RESTRU_FLAG');

INSERT INTO MCD_OUTPUT_F2 (R_ORDER, ACCT_NO , CUST_ID , HIGHEST_CUR_DELINQ , HIGHEST_30DAY_DELINQ , HIGHEST_60DAY_DELINQ ,HIGHEST_90DAY_DELINQ , HIGHEST_120DAY_DELINQ , HIGHEST_150DAY_DELINQ , HIGHEST_180DAY_DELINQ ,HIGHEST_210DAY_DELINQ , HIGHEST_240DAY_DELINQ , HIGHEST_270DAY_DELINQ , HIGHEST_300DAY_DELINQ ,HIGHEST_330DAY_DELINQ , HIGHEST_360DAY_DELINQ , HIGHEST_390DAY_DELINQ , HIGHEST_DELINQ_VAL ,HIGHEST_BAL_VAL , ACCT_STAT , ACC_REC_AMT , BANKRUPT_DT , BANKRUPT_FLG , BANKRUPT_VAL , CARD_TYP ,CHARGE_OFF_DT , CHARGE_OFF_FLG , CHARGE_OFF_VAL , CYC_ARR_FEE_VAL , CYC_ARR_INT_VAL , CYC_ARR_VAL ,CYC_BAL_VAL_WITH_EPP , CYC_CASH_ADV_CNT , CYC_CASH_ADV_VAL , CYC_CASH_ADV_LMT , CYC_CR_VAL , CYC_DB_VAL ,CYC_MERCH_PURC_CNT , CYC_MERCH_PURCH_VAL , CYC_PYMT_VAL , CYC_DT , CYC_MIN_PYMT_VAL , CYC_PAST_DUE_VAL ,CLOSED_DT , CARD_EXPY_DT , FST_CASH_ADV_DT , FST_MERCH_PURC_DT , LST_CASH_ADV_DT , LST_DEFAULT_DT ,LST_COL_DT , LST_CR_DT , LST_TOT_ARR_VAL_DT , LST_WOFF_DT , LST_MAINTAIN_ACCT_STAT_DT ,LST_MERCH_PURC_DT , LST_OUT_DEFAULT_DT , LST_PYMT_DT , START_OVERLMT_DT , DEFAULT_AMT , DEFAULT_FLG ,DEFAULT_REASON , EXT_COL_DT , EXT_COL_FLG , EXT_COL_VAL , FRAUD_DT , FRAUD_FLG , FRAUD_VAL , INT_RATE ,INVOLUNTARY_CL_DT , INVOLUNTARY_CL_FLG , INVOLUNTARY_CL_VAL , LEGAL_ACT_VALUE , LEGAL_DT , LEGAL_FLG ,LEGAL_STAT , LEGAL_VAL , CYC_INT_VAL , CYC_INT_DUE , NATIONALITY , RETURN_PYMT_CNT , OD_LMT ,ONSELLING_DT , ONSELLING_AMT , ONSELLING_PYMT_AMT , ONSELLING_REC , REC_SRC_CD ,REC_PRIN_AMT , REC_INT_AMT , REC_COST_AMT , REC_TOT_AMT , PYMT_METHOD , PLASTIC_STAT ,POSTING_CD , PREV_ACCT_STAT , PROD_CAT , PROD_CD , REASON_CL , REC_AMT , REC_DT , REMINDER , REPYMT_AGR ,RESTRU_DT , RESTRU_FLG , RESTRU_VAL , RESTRU_AGR , RETURN_STAND_INSTR_IND , STAT_CHG_DT , PAY_PROMISE_CNT ,PAY_PROMISE_CNT_BROKEN , TRAN_AMT , TRAN_SEQ_NO , TRAN_CD , TRAN_SYS_CD , TRAN_DT , TRAN_POST_DT ,USER_CD_1 , USER_CD_2 , USER_CD_3 , USER_CD_4 , WOFF_VAL , HIGHEST_ARR_PYMT , ACCT_CD , ACCT_PRD_SER_CD ,ACCT_STAT_2 , ACCT_STAT_3 , ACCT_TYP , ACC_INT , AGENT_CD , AUTHORISE_LMT , BILL_DT , BUS_ACT , CAMPAIGN_CD , CHQ_RETURN_IND , CHQ_RETURN_AMT , COLL_APPR_VAL , COLL_SALE_VAL , CONST_CD , CYC_ARR_COMM_VAL , CYC_ARR_PEN_VAL , CYC_ARR_PRIN_VAL , CYC_AVAIL_BAL_VAL , CYC_DY , CYC_LATE_CHARG_VAL , CYC_MISC_CHARG_VAL , CYC_WITHDRAW_LMT , CYC_LED_BAL_VAL , FINAL_PYMT_DT , LST_CR_TXN_DT , LST_DR_TXN_DT , LST_TXN_DT , OVERLMT_DT , FAC_CD , FAC_TYP , INSTALL_AMT , INSURE_OS_IND , LEGAL_ACT_DT , LEGAL_ACT_FLG , LOAN_TYP , PURPOSES , MAT_DT , ME_INSTALL_ARR_AMT , CYC_CR_CNT , CYC_CR_VAL_CA , CYC_DR_CNT , CYC_DR_VAL_CA , CYC_PRIN_BALOS , MRTA_IND , 
APPLICANT_CNT , GUARANTOR_CNT , OFFICER_CD , PROD_GRP , PROD_ORIG_BRN , PROD_SCH_TYP , PROD_TYP_DESC , PURPOSE_CD , REPYMT_PERIOD , RESTRU_PERIOD , RESCHE_FLG , SALARY_IND , SECTOR_CD , SETTLE_DT , SRC_CD , STANDING_INSTR_AMT , STANDING_INSTR_IND , SUB_TYP , TOT_OD_DRAWDOWN_AMT , SUB_PURPOSE , MAIN_TYP , TXN_DESC , CYC_BAL_VAL_WITHO_EPP , UNBILL_EPP , EPP_1ST_INSTALL_AMT , CR_LMT , COLL_VAL , DELINQ_BUCKET , OPEN_DT , MTD_LOWEST_BAL_AMT , MTD_TOT_BAL_AMT , MTD_TOT_DAYS , MTD_WITHDRAW_CNT , MTD_WITHDRAW_AMT , MTD_DEP_CNT , MTD_DEP_AMT , SAV_HOLD_FULL_AMT_IND , SAV_FLOAT_AMT , SAV_MIN_AMT , SAV_HOLD_AMT , AKPK , GL_GRP_CD , SPEC_PROVISION , LOAN_GRP , RETAIL_OD , TERM , REPYMT_PRIN , REPYMT_INT , REPYMT_FEE , REPYMT_LPI , EXCESS_VAL , SME_TAG , IIS_LEGAL_ACTION_STATUS , CM_TOT_OUT_BAL , CM_PROC_STAT , ACCT_OVERDUE_AMT , ACCT_RESCHED_RESTRU_FLAG) 
SELECT 2,ACCT_NO,CUST_ID,HIGHEST_CUR_DELINQ,HIGHEST_30DAY_DELINQ,HIGHEST_60DAY_DELINQ,HIGHEST_90DAY_DELINQ,HIGHEST_120DAY_DELINQ,HIGHEST_150DAY_DELINQ,HIGHEST_180DAY_DELINQ,HIGHEST_210DAY_DELINQ,HIGHEST_240DAY_DELINQ,HIGHEST_270DAY_DELINQ,HIGHEST_300DAY_DELINQ,HIGHEST_330DAY_DELINQ,HIGHEST_360DAY_DELINQ,HIGHEST_390DAY_DELINQ,HIGHEST_DELINQ_VAL,HIGHEST_BAL_VAL,ACCT_STAT,ACC_REC_AMT,BANKRUPT_DT,BANKRUPT_FLG,BANKRUPT_VAL,CARD_TYP,TO_CHAR(CHARGE_OFF_DT,'YYYYMMDD'),CHARGE_OFF_FLG,CHARGE_OFF_VAL,CYC_ARR_FEE_VAL,CYC_ARR_INT_VAL,CYC_ARR_VAL,CYC_BAL_VAL_WITH_EPP,CYC_CASH_ADV_CNT,CYC_CASH_ADV_VAL,CYC_CASH_ADV_LMT,CYC_CR_VAL,CYC_DB_VAL,CYC_MERCH_PURC_CNT,CYC_MERCH_PURCH_VAL,CYC_PYMT_VAL,TO_CHAR(CYC_DT,'YYYYMMDD'),CYC_MIN_PYMT_VAL,CYC_PAST_DUE_VAL,TO_CHAR(CLOSED_DT,'YYYYMMDD'),CARD_EXPY_DT,FST_CASH_ADV_DT,FST_MERCH_PURC_DT,LST_CASH_ADV_DT,LST_DEFAULT_DT,LST_COL_DT,LST_CR_DT,LST_TOT_ARR_VAL_DT,TO_CHAR(LST_WOFF_DT,'YYYYMMDD'),LST_MAINTAIN_ACCT_STAT_DT,LST_MERCH_PURC_DT,LST_OUT_DEFAULT_DT,TO_CHAR(LST_PYMT_DT,'YYYYMMDD'),START_OVERLMT_DT,DEFAULT_AMT,DEFAULT_FLG,DEFAULT_REASON,EXT_COL_DT,EXT_COL_FLG,EXT_COL_VAL,FRAUD_DT,FRAUD_FLG,FRAUD_VAL,INT_RATE,INVOLUNTARY_CL_DT,INVOLUNTARY_CL_FLG,INVOLUNTARY_CL_VAL,LEGAL_ACT_VALUE,TO_CHAR(LEGAL_DT,'YYYYMMDD'),LEGAL_FLG,LEGAL_STAT,LEGAL_VAL,CYC_INT_VAL,CYC_INT_DUE,NATIONALITY,RETURN_PYMT_CNT,OD_LMT,ONSELLING_DT,ONSELLING_AMT,ONSELLING_PYMT_AMT,ONSELLING_REC,REC_SRC_CD,REC_PRIN_AMT,REC_INT_AMT,REC_COST_AMT,REC_TOT_AMT,PYMT_METHOD,PLASTIC_STAT,POSTING_CD,PREV_ACCT_STAT,PROD_CAT,PROD_CD,REASON_CL,REC_AMT,REC_DT,REMINDER,REPYMT_AGR,RESTRU_DT,RESTRU_FLG,RESTRU_VAL,RESTRU_AGR,RETURN_STAND_INSTR_IND,STAT_CHG_DT,PAY_PROMISE_CNT,PAY_PROMISE_CNT_BROKEN,TRAN_AMT,TRAN_SEQ_NO,TRAN_CD,TRAN_SYS_CD,TRAN_DT,TRAN_POST_DT,USER_CD_1,USER_CD_2,USER_CD_3,USER_CD_4,WOFF_VAL,HIGHEST_ARR_PYMT,ACCT_CD,ACCT_PRD_SER_CD,ACCT_STAT_2,ACCT_STAT_3,ACCT_TYP,ACC_INT,AGENT_CD,AUTHORISE_LMT,BILL_DT,BUS_ACT,CAMPAIGN_CD,CHQ_RETURN_IND,CHQ_RETURN_AMT,COLL_APPR_VAL,COLL_SALE_VAL,CONST_CD,CYC_ARR_COMM_VAL,CYC_ARR_PEN_VAL,CYC_ARR_PRIN_VAL,CYC_AVAIL_BAL_VAL,CYC_DY,CYC_LATE_CHARG_VAL,CYC_MISC_CHARG_VAL,CYC_WITHDRAW_LMT,CYC_LED_BAL_VAL,TO_CHAR(FINAL_PYMT_DT,'YYYYMMDD'),LST_CR_TXN_DT,LST_DR_TXN_DT,LST_TXN_DT,OVERLMT_DT,FAC_CD,FAC_TYP ,INSTALL_AMT,INSURE_OS_IND,LEGAL_ACT_DT,LEGAL_ACT_FLG,LOAN_TYP,PURPOSES,TO_CHAR(MAT_DT,'YYYYMMDD'),ME_INSTALL_ARR_AMT,CYC_CR_CNT,CYC_CR_VAL_CA ,CYC_DR_CNT,CYC_DR_VAL_CA,CYC_PRIN_BALOS,MRTA_IND,APPLICANT_CNT,GUARANTOR_CNT,OFFICER_CD,PROD_GRP,PROD_ORIG_BRN,PROD_SCH_TYP,PROD_TYP_DESC,PURPOSE_CD ,REPYMT_PERIOD,RESTRU_PERIOD,RESCHE_FLG,SALARY_IND,SECTOR_CD,TO_CHAR(SETTLE_DT,'YYYYMMDD'),SRC_CD,STANDING_INSTR_AMT,STANDING_INSTR_IND,SUB_TYP,TOT_OD_DRAWDOWN_AMT,SUB_PURPOSE,MAIN_TYP,TXN_DESC,CYC_BAL_VAL_WITHO_EPP,UNBILL_EPP,EPP_1ST_INSTALL_AMT,CR_LMT,COLL_VAL,DELINQ_BUCKET,TO_CHAR(OPEN_DT,'YYYYMMDD'),MTD_LOWEST_BAL_AMT,MTD_TOT_BAL_AMT,MTD_TOT_DAYS,MTD_WITHDRAW_CNT,MTD_WITHDRAW_AMT,MTD_DEP_CNT,MTD_DEP_AMT,SAV_HOLD_FULL_AMT_IND,SAV_FLOAT_AMT,SAV_MIN_AMT,SAV_HOLD_AMT,AKPK,GL_GRP_CD,SPEC_PROVISION,LOAN_GRP,RETAIL_OD,TERM,REPYMT_PRIN,REPYMT_INT,REPYMT_FEE,REPYMT_LPI,EXCESS_VAL,SME_TAG,IIS_LEGAL_ACTION_STATUS,CM_TOT_OUT_BAL,CM_PROC_STAT,ACCT_OVERDUE_AMT,ACCT_RESCHED_RESTRU_FLAG FROM BSCORE_ALS_ACCT_UAT ;

EXECUTE 'copy (select R_ORDER, ACCT_NO , CUST_ID , HIGHEST_CUR_DELINQ , HIGHEST_30DAY_DELINQ , HIGHEST_60DAY_DELINQ ,HIGHEST_90DAY_DELINQ , HIGHEST_120DAY_DELINQ , HIGHEST_150DAY_DELINQ , HIGHEST_180DAY_DELINQ ,HIGHEST_210DAY_DELINQ , HIGHEST_240DAY_DELINQ , HIGHEST_270DAY_DELINQ , HIGHEST_300DAY_DELINQ ,HIGHEST_330DAY_DELINQ , HIGHEST_360DAY_DELINQ , HIGHEST_390DAY_DELINQ , HIGHEST_DELINQ_VAL ,HIGHEST_BAL_VAL , ACCT_STAT , ACC_REC_AMT , BANKRUPT_DT , BANKRUPT_FLG , BANKRUPT_VAL , CARD_TYP ,CHARGE_OFF_DT , CHARGE_OFF_FLG , CHARGE_OFF_VAL , CYC_ARR_FEE_VAL , CYC_ARR_INT_VAL , CYC_ARR_VAL ,CYC_BAL_VAL_WITH_EPP , CYC_CASH_ADV_CNT , CYC_CASH_ADV_VAL , CYC_CASH_ADV_LMT , CYC_CR_VAL , CYC_DB_VAL ,CYC_MERCH_PURC_CNT , CYC_MERCH_PURCH_VAL , CYC_PYMT_VAL , CYC_DT , CYC_MIN_PYMT_VAL , CYC_PAST_DUE_VAL ,CLOSED_DT , CARD_EXPY_DT , FST_CASH_ADV_DT , FST_MERCH_PURC_DT , LST_CASH_ADV_DT , LST_DEFAULT_DT ,LST_COL_DT , LST_CR_DT , LST_TOT_ARR_VAL_DT , LST_WOFF_DT , LST_MAINTAIN_ACCT_STAT_DT ,LST_MERCH_PURC_DT , LST_OUT_DEFAULT_DT , LST_PYMT_DT , START_OVERLMT_DT , DEFAULT_AMT , DEFAULT_FLG ,DEFAULT_REASON , EXT_COL_DT , EXT_COL_FLG , EXT_COL_VAL , FRAUD_DT , FRAUD_FLG , FRAUD_VAL , INT_RATE ,INVOLUNTARY_CL_DT , INVOLUNTARY_CL_FLG , INVOLUNTARY_CL_VAL , LEGAL_ACT_VALUE , LEGAL_DT , LEGAL_FLG ,LEGAL_STAT , LEGAL_VAL , CYC_INT_VAL , CYC_INT_DUE , NATIONALITY , RETURN_PYMT_CNT , OD_LMT ,ONSELLING_DT , ONSELLING_AMT , ONSELLING_PYMT_AMT , ONSELLING_REC , REC_SRC_CD ,REC_PRIN_AMT , REC_INT_AMT , REC_COST_AMT , REC_TOT_AMT , PYMT_METHOD , PLASTIC_STAT ,POSTING_CD , PREV_ACCT_STAT , PROD_CAT , PROD_CD , REASON_CL , REC_AMT , REC_DT , REMINDER , REPYMT_AGR ,RESTRU_DT , RESTRU_FLG , RESTRU_VAL , RESTRU_AGR , RETURN_STAND_INSTR_IND , STAT_CHG_DT , PAY_PROMISE_CNT ,PAY_PROMISE_CNT_BROKEN , TRAN_AMT , TRAN_SEQ_NO , TRAN_CD , TRAN_SYS_CD , TRAN_DT , TRAN_POST_DT ,USER_CD_1 , USER_CD_2 , USER_CD_3 , USER_CD_4 , WOFF_VAL , HIGHEST_ARR_PYMT , ACCT_CD , ACCT_PRD_SER_CD ,ACCT_STAT_2 , ACCT_STAT_3 , ACCT_TYP , ACC_INT , AGENT_CD , AUTHORISE_LMT , BILL_DT , BUS_ACT , CAMPAIGN_CD , CHQ_RETURN_IND , CHQ_RETURN_AMT , COLL_APPR_VAL , COLL_SALE_VAL , CONST_CD , CYC_ARR_COMM_VAL , CYC_ARR_PEN_VAL , CYC_ARR_PRIN_VAL , CYC_AVAIL_BAL_VAL , CYC_DY , CYC_LATE_CHARG_VAL , CYC_MISC_CHARG_VAL , CYC_WITHDRAW_LMT , CYC_LED_BAL_VAL , FINAL_PYMT_DT , LST_CR_TXN_DT , LST_DR_TXN_DT , LST_TXN_DT , OVERLMT_DT , FAC_CD , FAC_TYP , INSTALL_AMT , INSURE_OS_IND , LEGAL_ACT_DT , LEGAL_ACT_FLG , LOAN_TYP , PURPOSES , MAT_DT , ME_INSTALL_ARR_AMT , CYC_CR_CNT , CYC_CR_VAL_CA , CYC_DR_CNT , CYC_DR_VAL_CA , CYC_PRIN_BALOS , MRTA_IND , 
APPLICANT_CNT , GUARANTOR_CNT , OFFICER_CD , PROD_GRP , PROD_ORIG_BRN , PROD_SCH_TYP , PROD_TYP_DESC , PURPOSE_CD , REPYMT_PERIOD , RESTRU_PERIOD , RESCHE_FLG , SALARY_IND , SECTOR_CD , SETTLE_DT , SRC_CD , STANDING_INSTR_AMT , STANDING_INSTR_IND , SUB_TYP , TOT_OD_DRAWDOWN_AMT , SUB_PURPOSE , MAIN_TYP , TXN_DESC , CYC_BAL_VAL_WITHO_EPP , UNBILL_EPP , EPP_1ST_INSTALL_AMT , CR_LMT , COLL_VAL , DELINQ_BUCKET , OPEN_DT , MTD_LOWEST_BAL_AMT , MTD_TOT_BAL_AMT , MTD_TOT_DAYS , MTD_WITHDRAW_CNT , MTD_WITHDRAW_AMT , MTD_DEP_CNT , MTD_DEP_AMT , SAV_HOLD_FULL_AMT_IND , SAV_FLOAT_AMT , SAV_MIN_AMT , SAV_HOLD_AMT , AKPK , GL_GRP_CD , SPEC_PROVISION , LOAN_GRP , RETAIL_OD , TERM , REPYMT_PRIN , REPYMT_INT , REPYMT_FEE , REPYMT_LPI , EXCESS_VAL , SME_TAG , IIS_LEGAL_ACTION_STATUS , CM_TOT_OUT_BAL , CM_PROC_STAT , ACCT_OVERDUE_AMT , ACCT_RESCHED_RESTRU_FLAG from MCD_OUTPUT_F2 order by R_ORDER) to  ''' || FILE2 || ''';';
return;
END;


$body$  
LANGUAGE plpgsql VOLATILE;

