CREATE OR REPLACE FUNCTION BSCORE_OUTPUT_IMS_CUST(inout CURR_PROCESS_DATE DATE) RETURNS DATE AS $body$
DECLARE
cnt NUMERIC(25);
tot VARCHAR(27);
total NUMERIC(25,2);
FILE1 TEXT;
FILE2 TEXT;
buffer VARCHAR (1000);
RPT_DT DATE;
Business_Date VARCHAR(13);
Record_Count  VARCHAR(13);
HASH_Total    VARCHAR(13);
--ACCT_NO  NUMERIC(25);

BEGIN

SELECT count(ACCT_NO)  INTO  cnt FROM BSCORE_IMS_CUST;

CREATE TEMP TABLE MCD_OUTPUT_F1
(R_ORDER NUMERIC
, COL_1 VARCHAR(50) NULL
, COL_2 VARCHAR(50) NULL
, COL_3 VARCHAR(50) NULL
)
;
FILE1 := $$/home/gpadmin/PIDM_DIR/HBSCORE_IMS_CUST_$$ ||TO_CHAR(CURR_PROCESS_DATE,'YYYYMMDD')|| '.txt';
	 
INSERT INTO MCD_OUTPUT_F1 (R_ORDER,COL_1,COL_2) VALUES (1, 'BUSINESS_DATE','RECORD_COUNT');
	 INSERT INTO MCD_OUTPUT_F1 (R_ORDER,COL_1,COL_2) VALUES (2, TO_CHAR(CURR_PROCESS_DATE,'YYYYMMDD'),LPAD(CNT,10,'0'));

	EXECUTE 'copy (select COL_1,COL_2 from MCD_OUTPUT_F1 order by R_ORDER) to  ''' || FILE1 || ''';';



FILE2 := $$/home/gpadmin/PIDM_DIR/BSCORE_IMS_CUST_$$ ||TO_CHAR(CURR_PROCESS_DATE,'YYYYMMDD')|| '.txt';


CREATE TEMP TABLE MCD_OUTPUT_F2 (
R_ORDER NUMERIC
,ACCT_NO VARCHAR,PRIMARY_ID VARCHAR,REL_TYP_CD VARCHAR,PRIME_NO VARCHAR);

INSERT INTO MCD_OUTPUT_F2 (R_ORDER,ACCT_NO,PRIMARY_ID,REL_TYP_CD,PRIME_NO) VALUES (1,'ACCT_NO','PRIMARY_ID','REL_TYP_CD','PRIME_NO');

INSERT INTO MCD_OUTPUT_F2 (R_ORDER,ACCT_NO,PRIMARY_ID,REL_TYP_CD,PRIME_NO) SELECT 2,ACCT_NO,PRIMARY_ID,REL_TYP_CD,PRIME_NO FROM BSCORE_IMS_CUST;

return;
END;

$body$  
LANGUAGE plpgsql VOLATILE; 

