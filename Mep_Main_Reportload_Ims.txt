------
--DEV BY : Jitendra Lodwal  
--DATE  : 25-AUG-2011 
--DESC : FUNCTION
------
------
--DEV BY : Jitendra Lodwal  
--DATE  : 05-NOV-2011 
--DESC : FUNCTION_CODE_CORRECTION
------

SET SEARCH_PATH TO WORKAREA;

CREATE OR REPLACE FUNCTION Mep_Main_Reportload_Ims() RETURNS VOID AS $$
BEGIN


INSERT INTO MEP_LOG_IMS (ML_PROCESS_NAME,ML_RUN_START )
VALUES  ('PROGRAM TO INSERT DATA FROM MEP_DTL_ALS TO MEP_DTL_ALS_REPORT-SART',TO_CHAR(LOCALTIMESTAMP, 'DD-MON-YYYY HH:MI:SS') );

--EXECUTE IMMEDIATE 'TRUNCATE TABLE MEP_DTL_FINAL_REPORT';
INSERT INTO MEP_DTL_FINAL_REPORT( ACCT_NO,REP_MTH,SRC_SYS_CD,SEM_PROD_TYP,ACCT_OPEN_DT,PROD_TYPE,
NON_ACCRUAL,BLOCK_CD,CREDIT_LIMIT,LAST_AMT_PAID,MIN_AMT_DUE,MOB,RENEWAL_DT,CO_DELINQ_MTH,
APR,INDUSTRY,AMT_IN_ARREARS,PREV_DELINQ,CURRENT_AMT,DELINQ_BUCKET,
LOAN_AGE,PRIN_AMT,REMAIN_PRIN_AMT,PAID_AMT,PAYMENT_TYPE,LOAN_OPEN_DT,PAID_TODATE,
DRWAING_LIMIT,COLL_VALUE,ACCT_GL_GRP_CD,OVERLIMIT_AMT,LOAN_SUB_PROD,ACCT_STATUS,
UTILIZATION,BAL_AMT,
AVER_NET_RECEIVABLE,OVERLIMIT_CNT,ACTIVE,
PERC_OVERLIMIT,
AKPK,WATCHLIST_FLAG,IND_IMPAIRED,REC_AMT_TOTAL,
--RESCHED_CD,
WRITTEN_OFF,RECOVERY,NET_CREDIT_LOSS,GROSS_WRITTEN_OFF,CLOSED_IND,CLOSED,PAYMENT,
PAYMENT_RATE,REVENUE,INT_AMT,EARLY_APPROV_DT,MEP_PROD_TYP,AVAIL_BAL,SEC_TYPE
)

SELECT  DISTINCT MD_ACCT_NO, MD_REPORT_DT,MD_APPL_SYS_ID,'HL',MD_ACCT_OPEN_DT,MD_PRODUCT,
MD_NON_ACCRUAL,MD_BLOCK_CD, MD_CRDT_LMT,MD_LST_PYMT_AMT,MD_PAST_DUE,MD_MTH_ON_BOOK,MD_RENEW_DT,
MD_COINDC_DELI_ME,MD_APR, MD_INDUSTRY,MD_DELI_AMT,MD_PREV_DELI,MD_AMT_DUE,MD_DELI_BUCKET,
MD_LN_AGE,MD_PRINC_LN_AMT, MD_PRINC_REMAIN_AMT,MD_TOT_AMT_PAID,MD_PYMT_TYP,MD_LN_OPEN_DT,MD_PAID_PCT,
MD_DRAW_LMT,MD_COLLAT_VALUE,MD_ACCT_GL_GRP_CD,MD_OVERDUE_INT,MD_LN_SUB_PROD,
MD_ACCT_STAT,MD_UTILIZTN,MD_OS_AMT,
MD_NET_RECEIVE_AVG,MD_OVER_LMT_CNT_L1M,MD_ACTIVE_IND,MD_OVER_LMT_PCT,
MD_AKPK,MD_WATCHLIST_FLAG,MD_IND_IMPAIRED,MD_REC_AMT_TOTAL,--MD_RESCHED_CD
MD_WOFF_IND,MD_RECOVERY_AMT,MD_NET_CRDT_LOSS,MD_GROSS_WRITTEN_OFF,MD_CLOSED_IND,MD_CLOSED,MD_PAYMENT,
MD_PYMT_RT,MD_REVENUE,MD_INT_LN_AMT,MD_OD_APPROV_DT,'OD' AS MEP_PROD_TYP,MD_AVAILABLE_BAL,MD_COLL_TYP_CD
FROM MEP_DTL_IMS;
--COMMIT;

INSERT INTO MEP_LOG_IMS (ML_PROCESS_NAME,ML_RUN_START )
VALUES  ('PROGRAM TO INSERT DATA FROM MEP_DTL_ALS TO MEP_DTL_ALS_REPORT-END',TO_CHAR(LOCALTIMESTAMP, 'DD-MON-YYYY HH:MI:SS') );
--COMMIT;
END;
$$
LANGUAGE PLPGSQL;

