------
--DEV BY : Jitendra Lodwal  
--DATE  : 06-SEP-2011 
--DESC : FUNCTION
------
------
--DEV BY : Jitendra Lodwal  
--DATE  : 17-NOV-2011 
--DESC : Modified
------

SET SEARCH_PATH TO WORKAREA;

CREATE OR REPLACE FUNCTION Mep_Final_Output(inout P_DATE DATE) RETURNS DATE AS $body$
DECLARE
 
cnt NUMERIC(10);
tot VARCHAR(27);
total NUMERIC(25,2);

FILE1 TEXT;
FILE2 TEXT;

buffer VARCHAR (1000);
RPT_DT DATE;
Business_Date VARCHAR(13);
Record_Count  VARCHAR(13);
HASH_Total    VARCHAR(13);
--BAL_AMT  NUMERIC(18,2);
BAL_AMT1 NUMERIC(25,2);

BEGIN

SELECT SUM(BAL_AMT)  INTO  BAL_AMT1 FROM MEP_DTL_FINAL_REPORT;

BEGIN

IF  BAL_AMT1 < 0

THEN
    SELECT COUNT(ACCT_NO)
 --,SUM(BAL_AMT)
    ,TRIM(TO_CHAR(SUM(BAL_AMT),'099999999999999999999.99'))
     INTO cnt,tot
     FROM MEP_DTL_FINAL_REPORT;

   ELSE

       SELECT COUNT(ACCT_NO)
      --,SUM(BAL_AMT)
      ,TRIM(TO_CHAR(SUM(BAL_AMT),'0999999999999999999999.99'))
  INTO cnt,tot
   FROM MEP_DTL_FINAL_REPORT;
 END IF;

--total :=TO_CHAR(tot,'0999999999999999999999.99');
--total := tot;

CREATE TEMP TABLE MCD_OUTPUT_F1
(R_ORDER NUMERIC
, COL_1 VARCHAR(50) NULL
, COL_2 VARCHAR(50) NULL
, COL_3 VARCHAR(50) NULL
)
;

FILE1 := $$/home/gpadmin/PIDM_DIR/HDWLGD_M_$$ ||TO_CHAR(P_DATE,'YYYYMMDD')|| '.txt';

INSERT INTO MCD_OUTPUT_F1 (R_ORDER,COL_1,COL_2,COL_3) VALUES (1, 'BUSINESS_DATE','RECORD_COUNT','HASH_TOTAL');

INSERT INTO MCD_OUTPUT_F1 (R_ORDER,COL_1,COL_2,COL_3) VALUES (1, TO_CHAR(P_DATE,'yyyymmdd'),LPAD(cnt,10,'0'),tot);

	EXECUTE 'copy (select COL_1,COL_2 from MCD_OUTPUT_F1 order by R_ORDER) to  ''' || FILE1 || ''';';


CREATE TEMP TABLE MCD_OUTPUT_F2
(R_ORDER NUMERIC,REP_MTH VARCHAR,SRC_SYS_CD VARCHAR,SEM_PROD_TYP VARCHAR,ACCT_NO VARCHAR,CUST_NO VARCHAR,ACCT_OPEN_DT VARCHAR,PROD_TYPE VARCHAR,ACCT_STATUS VARCHAR,CLOSED_IND VARCHAR,CLOSED VARCHAR,NON_ACCRUAL VARCHAR,CARD_STATUS VARCHAR,CYCLE VARCHAR,ACTIVE VARCHAR,LOAN_SUPP VARCHAR,SUPP_CNT VARCHAR,AUTO_DEBIT VARCHAR,AUTO_DEBIT_OPT VARCHAR,BLOCK_CD VARCHAR,BLOCK_CD_REASON VARCHAR,CREDIT_LIMIT VARCHAR,CASH_ADV_LMT VARCHAR,PREV_CREDIT_LMT VARCHAR,HIGHEST_REDRAW_AMT VARCHAR,INSURANCE VARCHAR,LAST_AMT_PAID VARCHAR,LAST_AMT_PURCHASED VARCHAR,LAST_CREDIT_LMT_DT VARCHAR,LAST_PAY_DT VARCHAR,MIN_AMT_DUE VARCHAR,MOB VARCHAR,RENEWAL_DT VARCHAR,RENEWAL VARCHAR,SEC_IND VARCHAR,APR VARCHAR,INDUSTRY VARCHAR,AMT_IN_ARREARS VARCHAR,CO_DELINQ_MTH VARCHAR,CO_DELINQ_CYC VARCHAR,PREV_DELINQ VARCHAR,CURRENT_AMT VARCHAR,DELINQ_BUCKET VARCHAR,OVERLIMIT_CNT VARCHAR,OVERLIMIT_AMT VARCHAR,PERC_OVERLIMIT VARCHAR,WRITTEN_OFF VARCHAR,GROSS_WRITTEN_OFF VARCHAR,RECOVERY VARCHAR,NET_CREDIT_LOSS VARCHAR,COLL_COSTS VARCHAR,DISC_RATE_CHARG_OFF VARCHAR,UNBILLED_BAL VARCHAR,SOC_BAL_UNBILLED VARCHAR,EOM_BAL_UNBILLED VARCHAR,AVER_NET_RECEIVABLE VARCHAR,SOC_BAL VARCHAR,EOM_BAL VARCHAR,CASH_ADV_BAL VARCHAR,RET_BAL VARCHAR,SALES VARCHAR,CASH_ADV_SALE VARCHAR,RET_SALE VARCHAR,REVENUE VARCHAR,REVOLV_ACCT VARCHAR,REVOLV_ANR VARCHAR,REVOLV_BAL VARCHAR,REVOLV_RATE_ANR VARCHAR,REVOLV_BAL_RATIO VARCHAR,PAYMENT VARCHAR,PAYMENT_RATE VARCHAR,RISK_ADJ_YIELD VARCHAR,TREND_DELINQ VARCHAR,UTILIZATION VARCHAR,MUE VARCHAR,REMAIN_MUE VARCHAR,SIZE_REDRAW VARCHAR,USAGE_REDRAW VARCHAR,INSTALL_LIMIT VARCHAR,INSTALL_IND VARCHAR,INSTALL_STATUS VARCHAR,INSTALL_PROGRAM VARCHAR,LOAN_AGE VARCHAR,TERM VARCHAR,PRIN_AMT VARCHAR,INT_AMT VARCHAR,INT_ONLY VARCHAR,INT_RATE VARCHAR,INSTALL_AMT VARCHAR,INT_REPAYMENT VARCHAR,PRIN_REPAYMENT VARCHAR,REMAIN_INT_AMT VARCHAR,REMAIN_PRIN_AMT VARCHAR,UNEARN_INT_AMT VARCHAR,BAL_AMT VARCHAR,PAID_AMT VARCHAR,PAYMENT_TYPE VARCHAR,REMAIN_TERM VARCHAR,LOAN_OPEN_DT VARCHAR,LOAN_PURPOSE VARCHAR,LOAN_SUB_PROD VARCHAR,PAID_TODATE VARCHAR,ACCT_GL_GRP_CD VARCHAR,AKPK VARCHAR,SUPP_HOLDER VARCHAR,ASSET_POSSESSION VARCHAR,ASSET_SALE_PRICE VARCHAR,ASSET_SALE_DT VARCHAR,ASSET_TYPE VARCHAR,CAR_MAKE VARCHAR,DEMOGRAPHIC VARCHAR,FEES VARCHAR,INT_PAID VARCHAR,COLL_VALUE VARCHAR,WATCHLIST_FLAG VARCHAR,WATCHLIST_DT VARCHAR,PRIN_CARD_NO VARCHAR,IND_IMPAIRED VARCHAR,OD_APPROV_DT VARCHAR,DRWAING_LIMIT VARCHAR,AVAIL_BAL VARCHAR,EARLY_APPROV_DT VARCHAR,SEC_TYPE VARCHAR,BANKRUPT_DT VARCHAR,BANKRUPT_DT_FLG VARCHAR,BANKRUPT_VALUE VARCHAR,LAST_DEFAULT_DT VARCHAR,LAST_OUT_DEFAULT_DT VARCHAR,DT_LAST_PAY VARCHAR,ONSELLING_AMT VARCHAR,REC_AMT_TOTAL VARCHAR,AGENT_CD VARCHAR,LOAN_TYPE VARCHAR,MRTA_IND VARCHAR,PROD_SCHEME VARCHAR,PROD_TYPE_DESC VARCHAR,SETTLE_DT VARCHAR,ONSELLING_DT VARCHAR,MEP_PROD_TYP VARCHAR)
;

FILE2 := $$/home/gpadmin/PIDM_DIR/DWLGD_M_$$ ||TO_CHAR(P_DATE,'YYYYMMDD')|| '.txt';


INSERT INTO MCD_OUTPUT_F2 (R_ORDER,REP_MTH,SRC_SYS_CD,SEM_PROD_TYP,ACCT_NO,CUST_NO,ACCT_OPEN_DT,PROD_TYPE,ACCT_STATUS,CLOSED_IND,CLOSED,NON_ACCRUAL,CARD_STATUS,CYCLE,ACTIVE,LOAN_SUPP,SUPP_CNT,AUTO_DEBIT,AUTO_DEBIT_OPT,BLOCK_CD,BLOCK_CD_REASON,CREDIT_LIMIT,CASH_ADV_LMT,PREV_CREDIT_LMT,HIGHEST_REDRAW_AMT,INSURANCE,LAST_AMT_PAID,LAST_AMT_PURCHASED,LAST_CREDIT_LMT_DT,LAST_PAY_DT,MIN_AMT_DUE,MOB,RENEWAL_DT,RENEWAL,SEC_IND,APR,INDUSTRY,AMT_IN_ARREARS,CO_DELINQ_MTH,CO_DELINQ_CYC,PREV_DELINQ,CURRENT_AMT,DELINQ_BUCKET,OVERLIMIT_CNT,OVERLIMIT_AMT,PERC_OVERLIMIT,WRITTEN_OFF,GROSS_WRITTEN_OFF,RECOVERY,NET_CREDIT_LOSS,COLL_COSTS,DISC_RATE_CHARG_OFF,UNBILLED_BAL,SOC_BAL_UNBILLED,EOM_BAL_UNBILLED,AVER_NET_RECEIVABLE,SOC_BAL,EOM_BAL,CASH_ADV_BAL,RET_BAL,SALES,CASH_ADV_SALE,RET_SALE,REVENUE,REVOLV_ACCT,REVOLV_ANR,REVOLV_BAL,REVOLV_RATE_ANR,REVOLV_BAL_RATIO,PAYMENT,PAYMENT_RATE,RISK_ADJ_YIELD,TREND_DELINQ,UTILIZATION,MUE,REMAIN_MUE,SIZE_REDRAW,USAGE_REDRAW,INSTALL_LIMIT,INSTALL_IND,INSTALL_STATUS,INSTALL_PROGRAM,LOAN_AGE,TERM,PRIN_AMT,INT_AMT,INT_ONLY,INT_RATE,INSTALL_AMT,INT_REPAYMENT,PRIN_REPAYMENT,REMAIN_INT_AMT,REMAIN_PRIN_AMT,UNEARN_INT_AMT,BAL_AMT,PAID_AMT,PAYMENT_TYPE,REMAIN_TERM,LOAN_OPEN_DT,LOAN_PURPOSE,LOAN_SUB_PROD,PAID_TODATE,ACCT_GL_GRP_CD,AKPK,SUPP_HOLDER,ASSET_POSSESSION,ASSET_SALE_PRICE,ASSET_SALE_DT,ASSET_TYPE,CAR_MAKE,DEMOGRAPHIC,FEES,INT_PAID,COLL_VALUE,WATCHLIST_FLAG,WATCHLIST_DT,PRIN_CARD_NO,IND_IMPAIRED,OD_APPROV_DT,DRWAING_LIMIT,AVAIL_BAL,EARLY_APPROV_DT,SEC_TYPE,BANKRUPT_DT,BANKRUPT_DT_FLG,BANKRUPT_VALUE,LAST_DEFAULT_DT,LAST_OUT_DEFAULT_DT,DT_LAST_PAY,ONSELLING_AMT,REC_AMT_TOTAL,AGENT_CD,LOAN_TYPE,MRTA_IND,PROD_SCHEME,PROD_TYPE_DESC,SETTLE_DT,ONSELLING_DT,MEP_PROD_TYP) VALUES (1,'REP_MTH','SRC_SYS_CD','SEM_PROD_TYP','ACCT_NO','CUST_NO','ACCT_OPEN_DT','PROD_TYPE','ACCT_STATUS','CLOSED_IND','CLOSED','NON_ACCRUAL','CARD_STATUS','CYCLE','ACTIVE','LOAN_SUPP','SUPP_CNT','AUTO_DEBIT','AUTO_DEBIT_OPT','BLOCK_CD','BLOCK_CD_REASON','CREDIT_LIMIT','CASH_ADV_LMT','PREV_CREDIT_LMT','HIGHEST_REDRAW_AMT','INSURANCE','LAST_AMT_PAID','LAST_AMT_PURCHASED','LAST_CREDIT_LMT_DT','LAST_PAY_DT','MIN_AMT_DUE','MOB','RENEWAL_DT','RENEWAL','SEC_IND','APR','INDUSTRY','AMT_IN_ARREARS','CO_DELINQ_MTH','CO_DELINQ_CYC','PREV_DELINQ','CURRENT_AMT','DELINQ_BUCKET','OVERLIMIT_CNT','OVERLIMIT_AMT','PERC_OVERLIMIT','WRITTEN_OFF','GROSS_WRITTEN_OFF','RECOVERY','NET_CREDIT_LOSS','COLL_COSTS','DISC_RATE_CHARG_OFF','UNBILLED_BAL','SOC_BAL_UNBILLED','EOM_BAL_UNBILLED','AVER_NET_RECEIVABLE','SOC_BAL','EOM_BAL','CASH_ADV_BAL','RET_BAL','SALES','CASH_ADV_SALE','RET_SALE','REVENUE','REVOLV_ACCT','REVOLV_ANR','REVOLV_BAL','REVOLV_RATE_ANR','REVOLV_BAL_RATIO','PAYMENT','PAYMENT_RATE','RISK_ADJ_YIELD','TREND_DELINQ','UTILIZATION','MUE','REMAIN_MUE','SIZE_REDRAW','USAGE_REDRAW','INSTALL_LIMIT','INSTALL_IND','INSTALL_STATUS','INSTALL_PROGRAM','LOAN_AGE','TERM','PRIN_AMT','INT_AMT','INT_ONLY','INT_RATE','INSTALL_AMT','INT_REPAYMENT','PRIN_REPAYMENT','REMAIN_INT_AMT','REMAIN_PRIN_AMT','UNEARN_INT_AMT','BAL_AMT','PAID_AMT','PAYMENT_TYPE','REMAIN_TERM','LOAN_OPEN_DT','LOAN_PURPOSE','LOAN_SUB_PROD','PAID_TODATE','ACCT_GL_GRP_CD','AKPK','SUPP_HOLDER','ASSET_POSSESSION','ASSET_SALE_PRICE','ASSET_SALE_DT','ASSET_TYPE','CAR_MAKE','DEMOGRAPHIC','FEES','INT_PAID','COLL_VALUE','WATCHLIST_FLAG','WATCHLIST_DT','PRIN_CARD_NO','IND_IMPAIRED','OD_APPROV_DT','DRWAING_LIMIT','AVAIL_BAL','EARLY_APPROV_DT','SEC_TYPE','BANKRUPT_DT','BANKRUPT_DT_FLG','BANKRUPT_VALUE','LAST_DEFAULT_DT','LAST_OUT_DEFAULT_DT','DT_LAST_PAY','ONSELLING_AMT','REC_AMT_TOTAL','AGENT_CD','LOAN_TYPE','MRTA_IND','PROD_SCHEME','PROD_TYPE_DESC','SETTLE_DT','ONSELLING_DT','MEP_PROD_TYP');


INSERT INTO MCD_OUTPUT_F2 (R_ORDER,REP_MTH,SRC_SYS_CD,SEM_PROD_TYP,ACCT_NO,CUST_NO,ACCT_OPEN_DT,PROD_TYPE,ACCT_STATUS,CLOSED_IND,CLOSED,NON_ACCRUAL,CARD_STATUS,CYCLE,ACTIVE,LOAN_SUPP,SUPP_CNT,AUTO_DEBIT,AUTO_DEBIT_OPT,BLOCK_CD,BLOCK_CD_REASON,CREDIT_LIMIT,CASH_ADV_LMT,PREV_CREDIT_LMT,HIGHEST_REDRAW_AMT,INSURANCE,LAST_AMT_PAID,LAST_AMT_PURCHASED,LAST_CREDIT_LMT_DT,LAST_PAY_DT,MIN_AMT_DUE,MOB,RENEWAL_DT,RENEWAL,SEC_IND,APR,INDUSTRY,AMT_IN_ARREARS,CO_DELINQ_MTH,CO_DELINQ_CYC,PREV_DELINQ,CURRENT_AMT,DELINQ_BUCKET,OVERLIMIT_CNT,OVERLIMIT_AMT,PERC_OVERLIMIT,WRITTEN_OFF,GROSS_WRITTEN_OFF,RECOVERY,NET_CREDIT_LOSS,COLL_COSTS,DISC_RATE_CHARG_OFF,UNBILLED_BAL,SOC_BAL_UNBILLED,EOM_BAL_UNBILLED,AVER_NET_RECEIVABLE,SOC_BAL,EOM_BAL,CASH_ADV_BAL,RET_BAL,SALES,CASH_ADV_SALE,RET_SALE,REVENUE,REVOLV_ACCT,REVOLV_ANR,REVOLV_BAL,REVOLV_RATE_ANR,REVOLV_BAL_RATIO,PAYMENT,PAYMENT_RATE,RISK_ADJ_YIELD,TREND_DELINQ,UTILIZATION,MUE,REMAIN_MUE,SIZE_REDRAW,USAGE_REDRAW,INSTALL_LIMIT,INSTALL_IND,INSTALL_STATUS,INSTALL_PROGRAM,LOAN_AGE,TERM,PRIN_AMT,INT_AMT,INT_ONLY,INT_RATE,INSTALL_AMT,INT_REPAYMENT,PRIN_REPAYMENT,REMAIN_INT_AMT,REMAIN_PRIN_AMT,UNEARN_INT_AMT,BAL_AMT,PAID_AMT,PAYMENT_TYPE,REMAIN_TERM,LOAN_OPEN_DT,LOAN_PURPOSE,LOAN_SUB_PROD,PAID_TODATE,ACCT_GL_GRP_CD,AKPK,SUPP_HOLDER,ASSET_POSSESSION,ASSET_SALE_PRICE,ASSET_SALE_DT,ASSET_TYPE,CAR_MAKE,DEMOGRAPHIC,FEES,INT_PAID,COLL_VALUE,WATCHLIST_FLAG,WATCHLIST_DT,PRIN_CARD_NO,IND_IMPAIRED,OD_APPROV_DT,DRWAING_LIMIT,AVAIL_BAL,EARLY_APPROV_DT,SEC_TYPE,BANKRUPT_DT,BANKRUPT_DT_FLG,BANKRUPT_VALUE,LAST_DEFAULT_DT,LAST_OUT_DEFAULT_DT,DT_LAST_PAY,ONSELLING_AMT,REC_AMT_TOTAL,AGENT_CD,LOAN_TYPE,MRTA_IND,PROD_SCHEME,PROD_TYPE_DESC,SETTLE_DT,ONSELLING_DT,MEP_PROD_TYP)

SELECT 2,TO_CHAR(REP_MTH,'MM/DD/YYYY'),SRC_SYS_CD,SEM_PROD_TYP,ACCT_NO,CUST_NO,TO_CHAR(ACCT_OPEN_DT,'MM/DD/YYYY'),PROD_TYPE,ACCT_STATUS,CLOSED_IND,CLOSED,NON_ACCRUAL,CARD_STATUS,CYCLE,ACTIVE,LOAN_SUPP,SUPP_CNT,AUTO_DEBIT,AUTO_DEBIT_OPT,BLOCK_CD,BLOCK_CD_REASON,CREDIT_LIMIT,CASH_ADV_LMT,PREV_CREDIT_LMT,HIGHEST_REDRAW_AMT,INSURANCE,LAST_AMT_PAID,LAST_AMT_PURCHASED,TO_CHAR(LAST_CREDIT_LMT_DT,'MM/DD/YYYY'),TO_CHAR(LAST_PAY_DT,'MM/DD/YYYY'),MIN_AMT_DUE,MOB,TO_CHAR(RENEWAL_DT,'MM/DD/YYYY'),RENEWAL,SEC_IND,APR,INDUSTRY,AMT_IN_ARREARS,CO_DELINQ_MTH,CO_DELINQ_CYC,PREV_DELINQ,CURRENT_AMT,DELINQ_BUCKET,OVERLIMIT_CNT,OVERLIMIT_AMT,PERC_OVERLIMIT,WRITTEN_OFF,GROSS_WRITTEN_OFF,RECOVERY,NET_CREDIT_LOSS,COLL_COSTS,DISC_RATE_CHARG_OFF,UNBILLED_BAL,SOC_BAL_UNBILLED,EOM_BAL_UNBILLED,AVER_NET_RECEIVABLE,SOC_BAL,EOM_BAL,CASH_ADV_BAL,RET_BAL,SALES,CASH_ADV_SALE,RET_SALE,REVENUE,REVOLV_ACCT,REVOLV_ANR,REVOLV_BAL,REVOLV_RATE_ANR,REVOLV_BAL_RATIO,PAYMENT, '' PAYMENT_RATE,RISK_ADJ_YIELD,TREND_DELINQ,UTILIZATION,MUE,REMAIN_MUE,SIZE_REDRAW,USAGE_REDRAW,INSTALL_LIMIT,INSTALL_IND,INSTALL_STATUS,INSTALL_PROGRAM,LOAN_AGE,TERM,PRIN_AMT,INT_AMT,INT_ONLY,INT_RATE,INSTALL_AMT,INT_REPAYMENT,PRIN_REPAYMENT,REMAIN_INT_AMT,REMAIN_PRIN_AMT,UNEARN_INT_AMT,BAL_AMT,PAID_AMT,PAYMENT_TYPE,REMAIN_TERM,TO_CHAR(LOAN_OPEN_DT,'MM/DD/YYYY'),LOAN_PURPOSE,LOAN_SUB_PROD,PAID_TODATE,ACCT_GL_GRP_CD,AKPK,SUPP_HOLDER,ASSET_POSSESSION,ASSET_SALE_PRICE,TO_CHAR(ASSET_SALE_DT,'MM/DD/YYYY'),ASSET_TYPE,CAR_MAKE,DEMOGRAPHIC,FEES,INT_PAID,COLL_VALUE,WATCHLIST_FLAG,TO_CHAR(WATCHLIST_DT,'MM/DD/YYYY'),PRIN_CARD_NO,IND_IMPAIRED,TO_CHAR(OD_APPROV_DT,'MM/DD/YYYY'),DRWAING_LIMIT,AVAIL_BAL,TO_CHAR(EARLY_APPROV_DT,'MM/DD/YYYY'),SEC_TYPE,TO_CHAR(BANKRUPT_DT,'MM/DD/YYYY'),BANKRUPT_DT_FLG,BANKRUPT_VALUE,TO_CHAR(LAST_DEFAULT_DT,'MM/DD/YYYY'),TO_CHAR(LAST_OUT_DEFAULT_DT,'MM/DD/YYYY'),TO_CHAR(DT_LAST_PAY,'MM/DD/YYYY'),ONSELLING_AMT,REC_AMT_TOTAL,AGENT_CD,LOAN_TYPE,MRTA_IND,PROD_SCHEME,PROD_TYPE_DESC,TO_CHAR(SETTLE_DT,'MM/DD/YYYY'),TO_CHAR(ONSELLING_DT,'MM/DD/YYYY'),MEP_PROD_TYP FROM MEP_DTL_FINAL_REPORT;

EXECUTE 'copy (select REP_MTH,SRC_SYS_CD,SEM_PROD_TYP,ACCT_NO,CUST_NO,ACCT_OPEN_DT,PROD_TYPE,ACCT_STATUS,CLOSED_IND,CLOSED,NON_ACCRUAL,CARD_STATUS,CYCLE,ACTIVE,LOAN_SUPP,SUPP_CNT,AUTO_DEBIT,AUTO_DEBIT_OPT,BLOCK_CD,BLOCK_CD_REASON,CREDIT_LIMIT,CASH_ADV_LMT,PREV_CREDIT_LMT,HIGHEST_REDRAW_AMT,INSURANCE,LAST_AMT_PAID,LAST_AMT_PURCHASED,LAST_CREDIT_LMT_DT,LAST_PAY_DT,MIN_AMT_DUE,MOB,RENEWAL_DT,RENEWAL,SEC_IND,APR,INDUSTRY,AMT_IN_ARREARS,CO_DELINQ_MTH,CO_DELINQ_CYC,PREV_DELINQ,CURRENT_AMT,DELINQ_BUCKET,OVERLIMIT_CNT,OVERLIMIT_AMT,PERC_OVERLIMIT,WRITTEN_OFF,GROSS_WRITTEN_OFF,RECOVERY,NET_CREDIT_LOSS,COLL_COSTS,DISC_RATE_CHARG_OFF,UNBILLED_BAL,SOC_BAL_UNBILLED,EOM_BAL_UNBILLED,AVER_NET_RECEIVABLE,SOC_BAL,EOM_BAL,CASH_ADV_BAL,RET_BAL,SALES,CASH_ADV_SALE,RET_SALE,REVENUE,REVOLV_ACCT,REVOLV_ANR,REVOLV_BAL,REVOLV_RATE_ANR,REVOLV_BAL_RATIO,PAYMENT,PAYMENT_RATE,RISK_ADJ_YIELD,TREND_DELINQ,UTILIZATION,MUE,REMAIN_MUE,SIZE_REDRAW,USAGE_REDRAW,INSTALL_LIMIT,INSTALL_IND,INSTALL_STATUS,INSTALL_PROGRAM,LOAN_AGE,TERM,PRIN_AMT,INT_AMT,INT_ONLY,INT_RATE,INSTALL_AMT,INT_REPAYMENT,PRIN_REPAYMENT,REMAIN_INT_AMT,REMAIN_PRIN_AMT,UNEARN_INT_AMT,BAL_AMT,PAID_AMT,PAYMENT_TYPE,REMAIN_TERM,LOAN_OPEN_DT,LOAN_PURPOSE,LOAN_SUB_PROD,PAID_TODATE,ACCT_GL_GRP_CD,AKPK,SUPP_HOLDER,ASSET_POSSESSION,ASSET_SALE_PRICE,ASSET_SALE_DT,ASSET_TYPE,CAR_MAKE,DEMOGRAPHIC,FEES,INT_PAID,COLL_VALUE,WATCHLIST_FLAG,WATCHLIST_DT,PRIN_CARD_NO,IND_IMPAIRED,OD_APPROV_DT,DRWAING_LIMIT,AVAIL_BAL,EARLY_APPROV_DT,SEC_TYPE,BANKRUPT_DT,BANKRUPT_DT_FLG,BANKRUPT_VALUE,LAST_DEFAULT_DT,LAST_OUT_DEFAULT_DT,DT_LAST_PAY,ONSELLING_AMT,REC_AMT_TOTAL,AGENT_CD,LOAN_TYPE,MRTA_IND,PROD_SCHEME,PROD_TYPE_DESC,SETTLE_DT,ONSELLING_DT,MEP_PROD_TYP from MCD_OUTPUT_F2 order by R_ORDER) to  ''' || FILE2 || '''  with delimiter ''|'' null '''';';

return;
END;
END;
$body$  
LANGUAGE plpgsql VOLATILE; 

