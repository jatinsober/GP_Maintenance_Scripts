--
-- Dev: Jitendra Lodwal
-- Date: 09/DEC/2011
-- Desc: Intial Conversion
--

SEARCH_PATH TO MBS_LOANS;

CREATE OR REPLACE FUNCTION CS_DM_MBS_FDUP_TBL () RETURNS VOID AS $$
DECLARE
X_PeriodOfUpdate	DATE;
X_dtCurrentDt DATE;

BEGIN
X_PeriodOfUpdate :=CurrentLoadDt FROM DBScrub.TB_CS_DM_LoadDt;
X_dtCurrentDt:=X_PeriodOfUpdate;


--truncate all tmp tables
truncate table TB_CS_DM_PIF_TMP_EXP_STOL1;
truncate table TB_CS_DM_PIF_TMP_EXP_STOL;
truncate table TB_CS_DM_PIF_TMP_EXP_DECE1;
truncate table TB_CS_DM_PIF_TMP_EXP_DECE;
truncate table TB_CS_DM_PIF_TMP_EXP_FRAU1;
truncate table TB_CS_DM_PIF_TMP_EXP_FRAU;
truncate table TB_CS_DM_PIF_TMP_EXP_BKTCY1;
truncate table TB_CS_DM_PIF_TMP_EXP_BKTCY;
truncate table TB_CS_DM_PIF_TMP_EXP_WOFF1;
truncate table TB_CS_DM_PIF_TMP_EXP_WOFF;
truncate table TB_CS_DM_PIF_TMP_EXP_NPLF1;
truncate table TB_CS_DM_PIF_TMP_EXP_NPLF;
truncate table TB_CS_DM_PIF_TMP_EXP_RSRC1;
truncate table TB_CS_DM_PIF_TMP_EXP_RSRC;
truncate table TB_CS_DM_PIF_TMP_EXP_RCRSTAG;
truncate table TB_CS_DM_PIF_TMP_EXP_RCRSTAG1;
truncate table TB_CS_DM_PIF_TMP_EXP_MExpDt;
truncate table TB_CS_DM_PIF_TMP_EXP_NExpDt;
truncate table TB_CS_DM_PIF_TMP_EXP_LExpDt;
truncate table TB_CS_DM_PIF_TMP_EXP_FINAL;
truncate table TB_CS_DM_PIF_TMP_EXP_FINAL2;

--Start insert data
INSERT INTO TB_CS_DM_StatusLog (Report_Date, App_Sys_Code, Load_Msg, Start_DateTime)
VALUES (X_PeriodOfUpdate, 'MBS','Start TB_CS_DM_PIF_TMP_EXP_STOL', CURRENT_DATE);
INSERT INTO TB_CS_DM_PIF_TMP_EXP_STOL1
(ACCT_NO, STOLEN_VEH_UDR_INS_CLAIM_HP)
SELECT     ACCT_NO, MAX(STOLEN_VEH_UDR_INS_CLAIM_HP_TMP) AS STOLEN
FROM          TB_CS_DM_PIF_TMP_EXP
WHERE     (ProductGroup <> '06')
GROUP BY ACCT_NO;

INSERT INTO TB_CS_DM_PIF_TMP_EXP_STOL
SELECT a.*
FROM  MBS_LOANS.TB_CS_DM_PIF_TMP_EXP a, MBS_LOANS.TB_CS_DM_PIF_TMP_EXP_STOL1 b
WHERE a.ACCT_NO = b.ACCT_NO AND 
      a.STOLEN_VEH_UDR_INS_CLAIM_HP_TMP = b.STOLEN_VEH_UDR_INS_CLAIM_HP;
--End Insert
INSERT INTO TB_CS_DM_StatusLog (Report_Date, App_Sys_Code, Load_Msg, End_DateTime)
VALUES (X_PeriodOfUpdate, 'MBS','End TB_CS_DM_PIF_TMP_EXP_STOL', CURRENT_DATE);


--Start insert data
INSERT INTO TB_CS_DM_StatusLog (Report_Date, App_Sys_Code, Load_Msg, Start_DateTime)
VALUES (X_PeriodOfUpdate, 'MBS','Start TB_CS_DM_PIF_TMP_EXP_DECE', CURRENT_DATE);
INSERT INTO TB_CS_DM_PIF_TMP_EXP_DECE1
(ACCT_NO, DECEASED_FLAG)
SELECT     ACCT_NO, MAX(DECEASED_FLAG) AS DECE
FROM         TB_CS_DM_PIF_TMP_EXP_STOL
--WHERE     (ProductGroup <> '06')
GROUP BY ACCT_NO;

INSERT INTO TB_CS_DM_PIF_TMP_EXP_DECE
SELECT a.*
FROM  TB_CS_DM_PIF_TMP_EXP_STOL a, MBS_LOANS.TB_CS_DM_PIF_TMP_EXP_DECE1 b
WHERE a.ACCT_NO = b.ACCT_NO AND 
      a.DECEASED_FLAG = b.DECEASED_FLAG  ;    
--End Insert
INSERT INTO TB_CS_DM_StatusLog (Report_Date, App_Sys_Code, Load_Msg, End_DateTime)
VALUES (X_PeriodOfUpdate, 'MBS','End TB_CS_DM_PIF_TMP_EXP_DECE', CURRENT_DATE);


--Start insert data
INSERT INTO TB_CS_DM_StatusLog (Report_Date, App_Sys_Code, Load_Msg, Start_DateTime)
VALUES (X_PeriodOfUpdate, 'MBS','Start TB_CS_DM_PIF_TMP_EXP_FRAU', CURRENT_DATE);
INSERT INTO TB_CS_DM_PIF_TMP_EXP_FRAU1
(ACCT_NO, FRAUD_ACCT_FLAG_ALL)
SELECT     ACCT_NO, MAX(FRAUD_ACCT_FLAG_ALL) AS FRAU
FROM         TB_CS_DM_PIF_TMP_EXP_DECE
--WHERE     (ProductGroup <> '06')
GROUP BY ACCT_NO;

INSERT INTO TB_CS_DM_PIF_TMP_EXP_FRAU
SELECT a.*
FROM  MBS_LOANS.TB_CS_DM_PIF_TMP_EXP_DECE a, MBS_LOANS.TB_CS_DM_PIF_TMP_EXP_FRAU1 b
WHERE a.ACCT_NO = b.ACCT_NO AND 
      a.FRAUD_ACCT_FLAG_ALL = b.FRAUD_ACCT_FLAG_ALL  ;   
--End Insert
INSERT INTO TB_CS_DM_StatusLog (Report_Date, App_Sys_Code, Load_Msg, End_DateTime)
VALUES (X_PeriodOfUpdate, 'MBS','End TB_CS_DM_PIF_TMP_EXP_FRAU', CURRENT_DATE);


--Start insert data
INSERT INTO TB_CS_DM_StatusLog (Report_Date, App_Sys_Code, Load_Msg, Start_DateTime)
VALUES (X_PeriodOfUpdate, 'MBS','Start TB_CS_DM_PIF_TMP_EXP_BKTCY', CURRENT_DATE);
INSERT INTO TB_CS_DM_PIF_TMP_EXP_BKTCY1
(ACCT_NO, BANKRUPTCY)
SELECT     ACCT_NO, MAX(BANKRUPTCY) AS BKTCY
FROM         TB_CS_DM_PIF_TMP_EXP_FRAU
--WHERE     (ProductGroup <> '06')
GROUP BY ACCT_NO;

INSERT INTO TB_CS_DM_PIF_TMP_EXP_BKTCY
SELECT a.*
FROM  MBS_LOANS.TB_CS_DM_PIF_TMP_EXP_FRAU a, MBS_LOANS.TB_CS_DM_PIF_TMP_EXP_BKTCY1 b
WHERE a.ACCT_NO = b.ACCT_NO AND 
      a.BANKRUPTCY = b.BANKRUPTCY  ;   
--End Insert
INSERT INTO TB_CS_DM_StatusLog (Report_Date, App_Sys_Code, Load_Msg, End_DateTime)
VALUES (X_PeriodOfUpdate, 'MBS','End TB_CS_DM_PIF_TMP_EXP_BKTCY', CURRENT_DATE);


--Start insert data
INSERT INTO TB_CS_DM_StatusLog (Report_Date, App_Sys_Code, Load_Msg, Start_DateTime)
VALUES (X_PeriodOfUpdate, 'MBS','Start TB_CS_DM_PIF_TMP_EXP_WOFF', CURRENT_DATE);
INSERT INTO TB_CS_DM_PIF_TMP_EXP_WOFF1
(ACCT_NO, WRT_OFF_FLAG)
SELECT     ACCT_NO, MAX(WRT_OFF_FLAG) AS WOFF
FROM         TB_CS_DM_PIF_TMP_EXP_BKTCY
--WHERE     (ProductGroup <> '06')
GROUP BY ACCT_NO;

INSERT INTO TB_CS_DM_PIF_TMP_EXP_WOFF
SELECT a.*
FROM  MBS_LOANS.TB_CS_DM_PIF_TMP_EXP_BKTCY a, MBS_LOANS.TB_CS_DM_PIF_TMP_EXP_WOFF1 b
WHERE a.ACCT_NO = b.ACCT_NO AND 
      a.WRT_OFF_FLAG = b.WRT_OFF_FLAG ;
--End Insert
INSERT INTO TB_CS_DM_StatusLog (Report_Date, App_Sys_Code, Load_Msg, End_DateTime)
VALUES (X_PeriodOfUpdate, 'MBS','End TB_CS_DM_PIF_TMP_EXP_WOFF', CURRENT_DATE);


--Start insert data
INSERT INTO TB_CS_DM_StatusLog (Report_Date, App_Sys_Code, Load_Msg, Start_DateTime)
VALUES (X_PeriodOfUpdate, 'MBS','Start TB_CS_DM_PIF_TMP_EXP_NPLF', CURRENT_DATE);
INSERT INTO TB_CS_DM_PIF_TMP_EXP_NPLF1
(ACCT_NO, NPL_FLAG)
SELECT     ACCT_NO, MAX(NPL_FLAG) AS NPL
FROM         TB_CS_DM_PIF_TMP_EXP_WOFF
--WHERE     (ProductGroup <> '06')
GROUP BY ACCT_NO;

INSERT INTO TB_CS_DM_PIF_TMP_EXP_NPLF
SELECT a.*
FROM  MBS_LOANS.TB_CS_DM_PIF_TMP_EXP_WOFF a, MBS_LOANS.TB_CS_DM_PIF_TMP_EXP_NPLF1 b
WHERE a.ACCT_NO = b.ACCT_NO AND 
      a.NPL_FLAG = b.NPL_FLAG ;
--End Insert
INSERT INTO TB_CS_DM_StatusLog (Report_Date, App_Sys_Code, Load_Msg, End_DateTime)
VALUES (X_PeriodOfUpdate, 'MBS','End TB_CS_DM_PIF_TMP_EXP_NPLF', CURRENT_DATE);


--Start insert data
INSERT INTO TB_CS_DM_StatusLog (Report_Date, App_Sys_Code, Load_Msg, Start_DateTime)
VALUES (X_PeriodOfUpdate, 'MBS','Start TB_CS_DM_PIF_TMP_EXP_RCRSTAG', CURRENT_DATE);
INSERT INTO TB_CS_DM_PIF_TMP_EXP_RCRSTAG1
(ACCT_NO, RCRSTAG)
SELECT     ACCT_NO, MAX(RCRSTAG) AS RCRSTAG
FROM         TB_CS_DM_PIF_TMP_EXP_NPLF
--WHERE     (ProductGroup <> '06')
GROUP BY ACCT_NO;

INSERT INTO TB_CS_DM_PIF_TMP_EXP_RCRSTAG
SELECT a.*
FROM  MBS_LOANS.TB_CS_DM_PIF_TMP_EXP_NPLF a, MBS_LOANS.TB_CS_DM_PIF_TMP_EXP_RCRSTAG1 b
WHERE a.ACCT_NO = b.ACCT_NO AND 
      a.RCRSTAG = b.RCRSTAG ;
--End Insert
INSERT INTO TB_CS_DM_StatusLog (Report_Date, App_Sys_Code, Load_Msg, End_DateTime)
VALUES (X_PeriodOfUpdate, 'MBS','End TB_CS_DM_PIF_TMP_EXP_RCRSTAG', CURRENT_DATE);


--Start insert data
INSERT INTO TB_CS_DM_StatusLog (Report_Date, App_Sys_Code, Load_Msg, Start_DateTime)
VALUES (X_PeriodOfUpdate, 'MBS','Start TB_CS_DM_PIF_TMP_EXP_RSRC', CURRENT_DATE);
INSERT INTO TB_CS_DM_PIF_TMP_EXP_RSRC1
(ACCT_NO, RS_RC_ACCT_FLAG)
SELECT     ACCT_NO, MAX(RS_RC_ACCT_FLAG) AS RSRCFLG
FROM         TB_CS_DM_PIF_TMP_EXP_RCRSTAG
--WHERE     (ProductGroup <> '06')
GROUP BY ACCT_NO;

INSERT INTO TB_CS_DM_PIF_TMP_EXP_RSRC
SELECT a.*
FROM  MBS_LOANS.TB_CS_DM_PIF_TMP_EXP_RCRSTAG a, MBS_LOANS.TB_CS_DM_PIF_TMP_EXP_RSRC1 b
WHERE a.ACCT_NO = b.ACCT_NO AND 
      a.RS_RC_ACCT_FLAG = b.RS_RC_ACCT_FLAG ;
--End Insert
INSERT INTO TB_CS_DM_StatusLog (Report_Date, App_Sys_Code, Load_Msg, End_DateTime)
VALUES (X_PeriodOfUpdate, 'MBS','End TB_CS_DM_PIF_TMP_EXP_RSRC', CURRENT_DATE);


--Start insert data (get distinct record with NULL TagExpiryDt)
INSERT INTO TB_CS_DM_StatusLog (Report_Date, App_Sys_Code, Load_Msg, Start_DateTime)
VALUES (X_PeriodOfUpdate, 'MBS','Start TB_CS_DM_PIF_TMP_EXP_NExpDt', CURRENT_DATE);
INSERT INTO TB_CS_DM_PIF_TMP_EXP_NExpDt
(ACCT_NO, TagExpiryDt)
SELECT    DISTINCT ACCT_NO, TagExpiryDt
FROM         TB_CS_DM_PIF_TMP_EXP_RSRC
WHERE    TagExpiryDt IS NULL ;

--Start insert data (get record with Max TagExpiryDt)
INSERT INTO TB_CS_DM_StatusLog (Report_Date, App_Sys_Code, Load_Msg, Start_DateTime)
VALUES (X_PeriodOfUpdate, 'MBS','Start TB_CS_DM_PIF_TMP_EXP_MExpDt', CURRENT_DATE);
INSERT INTO TB_CS_DM_PIF_TMP_EXP_MExpDt
(ACCT_NO, TagExpiryDt)
SELECT     ACCT_NO AS Expr1, MAX(TagExpiryDt) AS MTagExpiryDt
FROM         TB_CS_DM_PIF_TMP_EXP_RSRC
WHERE     (TagExpiryDt IS NOT NULL)
GROUP BY ACCT_NO;

--Start insert data (get record with latest TagExpiryDt where TagExpiryDt is not null)
INSERT INTO TB_CS_DM_StatusLog (Report_Date, App_Sys_Code, Load_Msg, Start_DateTime)
VALUES (X_PeriodOfUpdate, 'MBS','Start TB_CS_DM_PIF_TMP_EXP_LExpDt', CURRENT_DATE);
INSERT INTO TB_CS_DM_PIF_TMP_EXP_LExpDt
(ACCT_NO, TagExpiryDt)
SELECT     TB_CS_DM_PIF_TMP_EXP_MExpDt.ACCT_NO, TB_CS_DM_PIF_TMP_EXP_MExpDt.TagExpiryDt
FROM         TB_CS_DM_PIF_TMP_EXP_NExpDt RIGHT OUTER JOIN
                     TB_CS_DM_PIF_TMP_EXP_MExpDt ON 
                     TB_CS_DM_PIF_TMP_EXP_NExpDt.ACCT_NO =TB_CS_DM_PIF_TMP_EXP_MExpDt.ACCT_NO
WHERE     (TB_CS_DM_PIF_TMP_EXP_NExpDt.ACCT_NO IS NULL);


--Start distinct data
INSERT INTO TB_CS_DM_StatusLog (Report_Date, App_Sys_Code, Load_Msg, Start_DateTime)
VALUES (X_PeriodOfUpdate, 'MBS','Start distinct MBS data & insert into TB_CS_DM_PIF_TMP_EXP_FINAL', CURRENT_DATE);

INSERT INTO TB_CS_DM_PIF_TMP_EXP_FINAL(ACCT_NO, REC_TYP, AGR_NO,
SEM_PROD_TYP,CUST_NO,CUST_ID,BALANCE,LIMITamt,GB_IND,GB_FLAG ,
GB_IND_HP,GB_FLAG_HP,GB_IND_HL,GB_FLAG_HL,GB_IND_CC,GB_FLAG_CC,
STAFF_FLAG,VIP_FLAG,CUST_STATUS,NPL_FLAG,PROD_TYP,CLOSED_DT,
WRT_OFF_FLAG,WRT_OFF_DT,APPL_DT,AGE_OF_ACCT,PERIOD_OF_UPD,
MIA,DEL_STATUS,RS_RC_ACCT_FLAG,WORST_ARR_L12M,NO_DEL_STS_2PLS_L12M,
NO_DEL_STS_3PLS_L12M,ARR_AMT,WORST_MIA_L3M,WORST_MIA_L6M,WORST_MIA_L9M,
FRAUD_ACCT_FLAG_ALL,FRAUD_ACCT_FLAG_CC,FRAUD_ACCT_FLAG_HP,FRAUD_ACCT_FLAG_HL,
ABD_PROJ_FLAG_HL,STOLEN_VEH_UDR_INS_CLAIM_HP,STOLEN_VEH_UDR_INS_CLAIM_HP_TMP,
PIF_SPARE_NUM_1,OLD_GB_IND,EFF_RATE,IIS,SP,FIRST_UTILISE_DISB_DT,UTILISATION_AMT,
WRT_OFF_AMT,LOAN_MAT_DT,LOCK_IN_PERIOD,PIF_SPARE_TXT_1,OLD_GB_FLAG,PIF_SPARE_TXT_3,
PIF_SPARE_TXT_4,PIF_SPARE_TXT_5,PIF_SPARE_TXT_6,PIF_SPARE_TXT_7,PIF_SPARE_TXT_8,
PIF_SPARE_TXT_9,PIF_SPARE_TXT_10,DECEASED_FLAG,CC_LOST_CRD_FLAG,CC_STOLEN_CRD_FLAG,
FULL_DISB_DT,DISB_AMT,AGE_OF_FIRST_DISB,DT_OF_RECV,RECV_AMT,FEES_INC_FRM_RECV,
CASH_ADV_AMT,SPARE_NUM_5,SPARE_NUM_6,SPARE_NUM_7,SPARE_NUM_8,SPARE_NUM_9,
SPARE_NUM_10,SPARE_NUM_11,SPARE_NUM_12,SPARE_NUM_13,SPARE_NUM_14,SPARE_NUM_15,
SPARE_TXT_1,SPARE_TXT_2,SPARE_TXT_3,SPARE_TXT_4,SPARE_TXT_5,SPARE_TXT_6,SPARE_TXT_7,
SPARE_TXT_8,SPARE_TXT_9,SPARE_TXT_10,SPARE_TXT_11,SPARE_TXT_12,SPARE_TXT_13,SPARE_TXT_14,
SPARE_TXT_15,PRS_Ind,MEP_PROD_TYP,TagEffectiveDt,TagExpiryDt,CusStatusRank,TimeKey,
ProductKey,StaticAcctNoKey,IntSpreadValue,PrtyCapInd,ProdCompCode,CycleDay,ProductGroup,
ProductClass,StrVIPCode,StrResidentStatus,StrStatus1,StrStatus2,StrWriteOffInd,StrFDIndicator,
LitigationCd,AccStatus,ProvisionTag,RCRSTag,Bankruptcy,AccountRelation)
SELECT DISTINCT(ACCT_NO) AS ACCT_NO, REC_TYP, AGR_NO,
SEM_PROD_TYP,CUST_NO,CUST_ID,BALANCE,LIMITamt,GB_IND,GB_FLAG ,
GB_IND_HP,GB_FLAG_HP,GB_IND_HL,GB_FLAG_HL,GB_IND_CC,GB_FLAG_CC,
STAFF_FLAG,VIP_FLAG,CUST_STATUS,NPL_FLAG,PROD_TYP,CLOSED_DT,
WRT_OFF_FLAG,WRT_OFF_DT,APPL_DT,AGE_OF_ACCT,PERIOD_OF_UPD,
MIA,DEL_STATUS,RS_RC_ACCT_FLAG,WORST_ARR_L12M,NO_DEL_STS_2PLS_L12M,
NO_DEL_STS_3PLS_L12M,ARR_AMT,WORST_MIA_L3M,WORST_MIA_L6M,WORST_MIA_L9M,
FRAUD_ACCT_FLAG_ALL,FRAUD_ACCT_FLAG_CC,FRAUD_ACCT_FLAG_HP,FRAUD_ACCT_FLAG_HL,
ABD_PROJ_FLAG_HL,STOLEN_VEH_UDR_INS_CLAIM_HP,STOLEN_VEH_UDR_INS_CLAIM_HP_TMP,
PIF_SPARE_NUM_1,OLD_GB_IND,EFF_RATE,IIS,SP,FIRST_UTILISE_DISB_DT,UTILISATION_AMT,
WRT_OFF_AMT,LOAN_MAT_DT,LOCK_IN_PERIOD,PIF_SPARE_TXT_1,OLD_GB_FLAG,PIF_SPARE_TXT_3,
PIF_SPARE_TXT_4,PIF_SPARE_TXT_5,PIF_SPARE_TXT_6,PIF_SPARE_TXT_7,PIF_SPARE_TXT_8,
PIF_SPARE_TXT_9,PIF_SPARE_TXT_10,DECEASED_FLAG,CC_LOST_CRD_FLAG,CC_STOLEN_CRD_FLAG,
FULL_DISB_DT,DISB_AMT,AGE_OF_FIRST_DISB,DT_OF_RECV,RECV_AMT,FEES_INC_FRM_RECV,
CASH_ADV_AMT,SPARE_NUM_5,SPARE_NUM_6,SPARE_NUM_7,SPARE_NUM_8,SPARE_NUM_9,
SPARE_NUM_10,SPARE_NUM_11,SPARE_NUM_12,SPARE_NUM_13,SPARE_NUM_14,SPARE_NUM_15,
SPARE_TXT_1,SPARE_TXT_2,SPARE_TXT_3,SPARE_TXT_4,SPARE_TXT_5,SPARE_TXT_6,SPARE_TXT_7,
SPARE_TXT_8,SPARE_TXT_9,SPARE_TXT_10,SPARE_TXT_11,SPARE_TXT_12,SPARE_TXT_13,SPARE_TXT_14,
SPARE_TXT_15,PRS_Ind,MEP_PROD_TYP,TagEffectiveDt,TagExpiryDt,CusStatusRank,TimeKey,
ProductKey,StaticAcctNoKey,IntSpreadValue,PrtyCapInd,ProdCompCode,CycleDay,ProductGroup,
ProductClass,StrVIPCode,StrResidentStatus,StrStatus1,StrStatus2,StrWriteOffInd,StrFDIndicator,
LitigationCd,AccStatus,ProvisionTag,RCRSTag,Bankruptcy,AccountRelation
FROM TB_CS_DM_PIF_TMP_EXP_RSRC;
--End Insert
INSERT INTO TB_CS_DM_StatusLog (Report_Date, App_Sys_Code, Load_Msg, End_DateTime)
VALUES (X_PeriodOfUpdate, 'MBS','End distinct MBS data & insert into TB_CS_DM_PIF_TMP_EXP_FINAL', CURRENT_DATE);

---INSERT INTO FINAL2
--Start insert data into FINAL2 (records with max TagExpiryDt)
INSERT INTO TB_CS_DM_StatusLog (Report_Date, App_Sys_Code, Load_Msg, Start_DateTime)
VALUES (X_PeriodOfUpdate, 'MBS','Start TB_CS_DM_PIF_TMP_EXP_FINAL2 insert Max TagExpiryDt', CURRENT_DATE);
INSERT INTO TB_CS_DM_PIF_TMP_EXP_FINAL2
SELECT a.*
FROM  TB_CS_DM_PIF_TMP_EXP_FINAL a, TB_CS_DM_PIF_TMP_EXP_LExpDt b
WHERE a.ACCT_NO = b.ACCT_NO AND 
      a.TagExpiryDt = b.TagExpiryDt;
--End Insert
INSERT INTO TB_CS_DM_StatusLog (Report_Date, App_Sys_Code, Load_Msg, End_DateTime)
VALUES (X_PeriodOfUpdate, 'MBS','End TB_CS_DM_PIF_TMP_EXP_FINAL2 insert Max TagExpiryDt', CURRENT_DATE);

--Start insert data into FINAL2 (records with NULL TagExpiryDt)
INSERT INTO TB_CS_DM_StatusLog (Report_Date, App_Sys_Code, Load_Msg, Start_DateTime)
VALUES (X_PeriodOfUpdate, 'MBS','Start TB_CS_DM_PIF_TMP_EXP_FINAL2 insert NULL TagExpiryDt', CURRENT_DATE);
INSERT INTO TB_CS_DM_PIF_TMP_EXP_FINAL2
SELECT     *
FROM         TB_CS_DM_PIF_TMP_EXP_FINAL
WHERE     (TagExpiryDt IS NULL);
--End Insert
INSERT INTO TB_CS_DM_StatusLog (Report_Date, App_Sys_Code, Load_Msg, End_DateTime)
VALUES (X_PeriodOfUpdate, 'MBS','End TB_CS_DM_PIF_TMP_EXP_FINAL2 insert NULL TagExpiryDt', CURRENT_DATE);


--Start insert LOC data into FINAL2
INSERT INTO TB_CS_DM_StatusLog (Report_Date, App_Sys_Code, Load_Msg, Start_DateTime)
VALUES (X_PeriodOfUpdate, 'MBS','Start insert LOC data into TB_CS_DM_PIF_TMP_EXP_FINAL2', CURRENT_DATE);
INSERT INTO TB_CS_DM_PIF_TMP_EXP_FINAL2
SELECT * FROM    TB_CS_DM_PIF_TMP_EXP
WHERE     (ProductGroup = '06');
--Start distinct data
INSERT INTO TB_CS_DM_StatusLog (Report_Date, App_Sys_Code, Load_Msg, Start_DateTime)
VALUES (X_PeriodOfUpdate, 'MBS','End insert LOC data into TB_CS_DM_PIF_TMP_EXP_FINAL2', CURRENT_DATE);

END;
$$
LANGUAGE PLPGSQL;