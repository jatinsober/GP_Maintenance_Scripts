------
--DEV BY : Jitendra Lodwal  
--DATE  : 25-AUG-2011 
--DESC : FUNCTION
------
------
--DEV BY : Jitendra Lodwal  
--DATE  : 05-NOV-2011 
--DESC : FUNCTION_CODE_CORRECTION
------

SET SEARCH_PATH TO WORKAREA;

CREATE OR REPLACE FUNCTION Mep_Main_Reportload_Ics() RETURNS VOID AS $$
BEGIN

INSERT INTO MEP_LOG_ICS (ML_PROCESS_NAME,ML_RUN_START )
VALUES  ('PROGRAM TO INSERT DATA FROM MEP_DTL_ICS TO MEP_DTL_FINAL_REPORT-SART',TO_CHAR(LOCALTIMESTAMP, 'DD-MON-YYYY HH:MI:SS') );
--EXECUTE IMMEDIATE 'TRUNCATE TABLE MEP_DTL_ICS_REPORT';

INSERT INTO MEP_DTL_FINAL_REPORT(ACCT_NO,REP_MTH,SRC_SYS_CD,SEM_PROD_TYP,PROD_TYPE,ACCT_OPEN_DT,
ACCT_STATUS,CYCLE,BLOCK_CD,CREDIT_LIMIT,INSURANCE,MOB,
APR,TERM,INT_RATE,INSTALL_AMT,BAL_AMT,LOAN_PURPOSE,LOAN_SUB_PROD,PAID_TODATE,
RENEWAL_DT,INSTALL_IND,CLOSED_IND,LAST_AMT_PAID,LAST_PAY_DT,
INDUSTRY,LOAN_AGE,PRIN_AMT,INT_AMT,PAID_AMT,PAYMENT_TYPE,REMAIN_TERM,LOAN_OPEN_DT,
UNEARN_INT_AMT,FEES,SEC_IND,WRITTEN_OFF,REMAIN_PRIN_AMT,
AVAIL_BAL,PRIN_REPAYMENT,AMT_IN_ARREARS,TREND_DELINQ,
CO_DELINQ_MTH,RECOVERY,PREV_DELINQ,AUTO_DEBIT,DELINQ_BUCKET,ACTIVE,CURRENT_AMT,
NET_CREDIT_LOSS,AVER_NET_RECEIVABLE,
PAYMENT_RATE,REMAIN_INT_AMT,INT_REPAYMENT,
AKPK,ASSET_POSSESSION,ASSET_SALE_DT,ASSET_TYPE,CAR_MAKE,WATCHLIST_FLAG,IND_IMPAIRED,
COLL_VALUE,PAYMENT,NON_ACCRUAL,CLOSED,GROSS_WRITTEN_OFF,INT_PAID,MEP_PROD_TYP)

SELECT DISTINCT MD_ACCT_NO,MD_REPORT_DT,MD_APPL_SYS_ID,'HP',MD_PROD_CD,MD_ACCT_OPEN_DT,
MD_ACCT_STAT,MD_CYCLE,MD_BLOCK_CD, MD_CRDT_LMT,MD_INSURANCE,MD_MTH_ON_BOOK,
MD_APR,CAST(MD_LN_TERM AS NUMERIC),MD_INT_RT,MD_MTH_AMORT,MD_OS_AMT,MD_LN_PURPOSE,MD_LN_SUB_PROD,MD_PAID_PCT,
MD_MATUR_DT,MD_INSTALL_IND,MD_CLOSED_IND,MD_LST_PYMT_AMT,MD_LST_PYMT_DT,MD_INDUSTRY,MD_LN_AGE,
MD_PRINC_LN_AMT,MD_INT_AMT,MD_TOT_AMT_PAID,'STRAIGHT',MD_REMAIN_TERMS,MD_LN_OPEN_DT,
MD_CUR_INT_UNEARN,MD_FEE_AS,MD_SEC_IND,MD_WOFF_IND,MD_PRINC_REMAIN_AMT,MD_IIS_TOT_OS,
MD_TOT_PRINC_PAID, MD_DELI_AMT,MD_MIA_TOT,MD_COINDC_DELI_ME,MD_RECOVERY_AMT,MD_PREV_DELI,
MD_AUTO_DBT_IND,MD_DELI_BUCKET,MD_ACTIVE_IND,MD_AMT_DUE,
MD_NET_CRDT_LOSS,MD_NET_RECEIVE_AVG,

MD_PYMT_RT,MD_INT_REMAIN_AMT,MD_TOT_INT_PAID,MD_AKPK,
MD_ASSET_POSSESSION,MD_ASSET_SALE_DT,MD_ASSET_TYPE,MD_CAR_MAKE,MD_WATCHLIST_FLAG,MD_IND_IMPAIRED,
MD_COLL_VALUE,MD_PAYMENT,MD_NON_ACCRUAL,MD_CLOSED,MD_GROSS_WRITTEN_OFF,MD_INT_PAID,'HP' AS MEP_PROD_TYPE
FROM MEP_DTL_ICS;

--COMMIT;


INSERT INTO MEP_LOG_ICS (ML_PROCESS_NAME,ML_RUN_START )
VALUES  ('PROGRAM TO INSERT DATA FROM MEP_DTL_ICS TO MEP_DTL_FINAL_REPORT-END',TO_CHAR(LOCALTIMESTAMP, 'DD-MON-YYYY HH:MI:SS') );
--COMMIT;
END;

$$
LANGUAGE PLPGSQL;
