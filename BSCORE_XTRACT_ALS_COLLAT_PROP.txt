------
--DEV BY : Jitendra Lodwal  
--DATE  : 26-AUG-2011 
--DESC : FUNCTION
------

SET SEARCH_PATH TO WORKAREA;
CREATE OR REPLACE FUNCTION BSCORE_XTRACT_ALS_COLLAT_PROP(CYC_DT IN DATE) RETURNS VOID AS $$
BEGIN

	TRUNCATE TABLE BSCORE_ALS_COLLAT_PROP;
	--COMMIT;
	INSERT INTO BSCORE_ALS_COLLAT_PROP(BUS_CYC_DT, ACCT_NO, COLL_NO, ONSELLING_DT, ONSELLING_AMT, COLL_VAL ,MRTA_MRTT_IND)
	SELECT CYC_DT, COAR_R_ACCT_NO, COAR_COLL_NO, PROP_FCLOS_AUCTION_DT, PROP_RESERVE_VAL, PROP_MKRT_VALUE ,
	
	CASE WHEN PROP_INS_AMT <> 0 THEN 'Y' ELSE 'N' END AS MRTA_MRTT_IND
	FROM dwprod.collat_acct_rel_ht_1_prt_collat_acct_rel_ht_201102 COAR, dwprod.collat_prop_ht_1_prt_collat_prop_ht_201102 COP 
	
	WHERE COAR.COAR_COLL_NO = COP.PROP_COLL_NO
	AND COAR.COAR_R_APPL_SYS_ID = 'ALS';
	--COMMIT;
END;
$$
LANGUAGE PLPGSQL;
