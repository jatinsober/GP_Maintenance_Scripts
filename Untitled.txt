
------
--DEV BY : Jitendra Lodwal  
--DATE  : 04-OCT-2011 
--DESC : FUNCTION
------

SET SEARCH_PATH TO WORKAREA;

CREATE OR REPLACE FUNCTION Mep_Main_Reportload_Cps () RETURNS VOID AS $$

BEGIN


INSERT INTO MEP_LOG_CPS (ML_PROCESS_NAME,ML_RUN_START )
VALUES  ('PROGRAM TO INSERT DATA FROM MEP_DTL_CPS TO MEP_DTL_FINAL_REPORT-SART',TO_CHAR(LOCALTIMESTAMP, 'DD-MON-YYYY HH:MI:SS') );


INSERT INTO MEP_DTL_FINAL_REPORT(REP_MTH,ACCT_NO,SRC_SYS_CD,SEM_PROD_TYP,ACCT_OPEN_DT,PROD_TYPE,
ACCT_STATUS,CARD_STATUS,CYCLE,BLOCK_CD,MOB,APR,AMT_IN_ARREARS,CO_DELINQ_MTH,
LOAN_AGE,TERM,PRIN_AMT,
BAL_AMT,LOAN_OPEN_DT,LOAN_SUB_PROD,ACTIVE,WRITTEN_OFF,AUTO_DEBIT,
CREDIT_LIMIT,CASH_ADV_LMT,LAST_AMT_PAID,LAST_CREDIT_LMT_DT,LAST_PAY_DT
,UTILIZATION,INSTALL_LIMIT,REMAIN_TERM,
RET_BAL,RENEWAL_DT,TREND_DELINQ,OVERLIMIT_CNT,OVERLIMIT_AMT, PREV_DELINQ,CURRENT_AMT,
DELINQ_BUCKET,GROSS_WRITTEN_OFF,AVER_NET_RECEIVABLE,INT_RATE,INSTALL_AMT,LOAN_PURPOSE,PAID_TODATE,
PREV_CREDIT_LMT,LOAN_SUPP,SUPP_CNT,AKPK,WATCHLIST_FLAG,WATCHLIST_DT,NON_ACCRUAL,PRIN_CARD_NO,
SUPP_HOLDER,PAYMENT,CLOSED,MEP_PROD_TYP)

SELECT MD_REPORT_DT,MD_ACCT_NO,MD_APPL_SYS_ID,'CC',MD_ACCT_OPEN_DT,MD_PRODUCT
,MD_ACCT_STAT,MD_CARD_STAT,SUBSTR(MD_CYCLE,1,2),MD_BLOCK_CD,MD_MTH_ON_BOOK,MD_APR,MD_DELI_AMT,MD_COINDC_DELI_ME,
MD_LN_AGE,CAST(MD_LN_TERM AS NUMERIC),
MD_PRINC_LN_AMT,MD_OS_AMT,MD_LN_OPEN_DT,MD_LN_SUB_PROD,
MD_ACTIVE_IND,MD_WOFF_IND,MD_AUTO_DBT_IND,MD_CRDT_LMT, MD_CASH_ADV_LMT,
MD_LST_PYMT_AMT,MD_LST_CRDT_LMT_DT,MD_LST_PYMT_DT,
MD_UTILIZTN,MD_INSTALL_LMT,MD_MTH_AMORT,
--MD_DPD_AMT1,MD_DPD_AMT2,MD_DPD_AMT3,MD_DPD_AMT4,
MD_RETAIL_BAL,MD_RENEW_DT,MD_PAST_DUE,MD_OVER_LMT_CNT_L1M,MD_OVER_LMT_AMT,MD_PREV_DELI,MD_AMT_DUE,
MD_DELI_BUCKET,MD_WOFF_AMT,MD_NET_RECEIVE_AVG,MD_INT_RT,MD_MTH_AMORT,MD_LN_PURPOSE,MD_PAID_PCT,
MD_PREV_CRDT_LMT,MD_LN_SUPP_IND,MD_SUPP_CNT,MD_AKPK,MD_WATCHLIST_FLAG,MD_WATCH_DATE,MD_NON_ACCRUAL,MD_PRINC_CARD_NO,
MD_SUPPL_HOLDER_NO,MD_PAYMENT,MD_CLOSED,'CC' AS MEP_PROD_TYP  FROM MEP_DTL_CPS;

INSERT INTO MEP_LOG_ICS (ML_PROCESS_NAME,ML_RUN_START )
VALUES  ('PROGRAM TO INSERT DATA FROM MEP_DTL_ICS TO MEP_DTL_FINAL_REPORT-END',TO_CHAR(LOCALTIMESTAMP, 'DD-MON-YYYY HH:MI:SS') );

END;
$$
LANGUAGE PLPGSQL;
