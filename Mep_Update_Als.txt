------
--DEV BY : Jitendra Lodwal  
--DATE  : 25-AUG-2011 
--DESC : FUNCTION
------

SET SEARCH_PATH TO WORKAREA;

CREATE OR REPLACE FUNCTION Mep_Update_Als() RETURNS VOID AS $$

BEGIN
BEGIN
INSERT INTO MEP_LOG_ALS (ML_PROCESS_NAME,ML_RUN_START )
VALUES  ('APR11',TO_CHAR(LOCALTIMESTAMP, 'DD-MON-YYYY HH:MI:SS AM') );
--COMMIT;
END;
--ACCT_HT_ALS
TRUNCATE TABLE ACCT_HT_ALS;
INSERT INTO ACCT_HT_ALS
SELECT * FROM dwprod.acct_ht_1_prt_acct_ht_201104
WHERE ACCT_APPL_SYS_ID='ALS';
--COMMIT;
--COMMERCIAL_LOAN_HT_ALS
TRUNCATE TABLE COMMERCIAL_LOAN_HT_ALS;
INSERT INTO COMMERCIAL_LOAN_HT_ALS
SELECT * FROM  dwprod.commercial_loan_ht_1_prt_commercial_loan_ht_201104
WHERE  CM_APPL_SYS_ID = 'ALS';
--COMMIT;

-- COLLAT_ACCT_REL_HT_ALS
TRUNCATE TABLE COLLAT_ACCT_REL_HT_ALS;
INSERT INTO COLLAT_ACCT_REL_HT_ALS
SELECT * FROM   dwprod.collat_acct_rel_ht_1_prt_collat_acct_rel_ht_201104
WHERE COAR_R_APPL_SYS_ID = 'ALS';

--COMMERCIAL_LOAN_HT_ALS_PREV
TRUNCATE TABLE COMMERCIAL_LOAN_HT_ALS_PREV;
INSERT INTO COMMERCIAL_LOAN_HT_ALS_PREV (CM_ACCT_ID,CM_ACCT_NO,CM_BUS_CYC_DT,CM_TOT_OUT_BAL)
SELECT CM_ACCT_ID,CM_ACCT_NO,CM_BUS_CYC_DT,CM_TOT_OUT_BAL
FROM  dwprod.commercial_loan_ht_1_prt_commercial_loan_ht_201103
WHERE  CM_APPL_SYS_ID = 'ALS';
--COMMIT;
--CREDIT_PROVISIONS_HT_ALS
TRUNCATE TABLE CREDIT_PROVISIONS_HT_ALS;
INSERT INTO CREDIT_PROVISIONS_HT_ALS
SELECT *
FROM dwprod.credit_provisions_ht_1_prt_credit_provisions_ht_201104
WHERE IIS_APPL_SYS_ID = 'ALS';
--COMMIT;
--CREDIT_PROVISIONS_HT_ALS_PREV
TRUNCATE TABLE CREDIT_PROVISIONS_HT_ALS_PREV;
INSERT INTO CREDIT_PROVISIONS_HT_ALS_PREV(IIS_ACCT_ID,IIS_ACCT_NO,IIS_BUS_CYC_DT,IIS_MOS_IN_ARREARS)
SELECT IIS_ACCT_ID,IIS_ACCT_NO,IIS_BUS_CYC_DT,IIS_MOS_IN_ARREARS
FROM dwprod.credit_provisions_ht_1_prt_credit_provisions_ht_201103
WHERE IIS_APPL_SYS_ID = 'ALS';
--COMMIT;
--COLLAT_PROP_HT_ALS
TRUNCATE TABLE COLLAT_PROP_HT_ALS;
INSERT INTO COLLAT_PROP_HT_ALS (PROP_BUS_CYC_DT ,PROP_COLL_NO,PROP_MKRT_VALUE ,PROP_INS_TYP,PROP_TYP_CD,PROP_RESERVE_VAL
                                ,PROP_FCLOS_AUCTION_DT,PROP_DISTRICT)
SELECT PROP_BUS_CYC_DT ,PROP_COLL_NO,PROP_MKRT_VALUE ,PROP_INS_TYP,PROP_TYP_CD,PROP_RESERVE_VAL ,
                                 PROP_FCLOS_AUCTION_DT,PROP_DISTRICT
FROM dwprod.collat_prop_ht_1_prt_collat_prop_ht_201104;
--COMMIT;
--COLLAT_FIN_HT_ALS
TRUNCATE TABLE COLLAT_FIN_HT_ALS;
INSERT INTO COLLAT_FIN_HT_ALS
SELECT *
FROM dwprod.collat_fin_ht_1_prt_collat_fin_ht_201104;
--COMMIT;
BEGIN
INSERT INTO MEP_LOG_ALS (ML_PROCESS_NAME,ML_RUN_START )
VALUES  ('APR11',TO_CHAR(LOCALTIMESTAMP, 'DD-MON-YYYY HH:MI:SS AM') );
--COMMIT;
END;
END;
$$
LANGUAGE PLPGSQL;

