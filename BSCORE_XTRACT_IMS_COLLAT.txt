------
--DEV BY : Jitendra Lodwal  
--DATE  : 26-AUG-2011 
--DESC : FUNCTION
------

SET SEARCH_PATH TO WORKAREA;
CREATE OR REPLACE FUNCTION BSCORE_XTRACT_IMS_COLLAT(RUN_DATE IN DATE) RETURNS VOID AS $$
DECLARE
	 PROC_DT2 DATE;

BEGIN

	 PROC_DT2 := RUN_DATE;
	 TRUNCATE TABLE BSCORE_IMS_COLLAT;
	 
	 INSERT INTO BSCORE_LOG_IMS(SYS_ID, BUS_CYC_DT, PROCESS_MSG, PROC_DT)
	 VALUES ('IMS', RUN_DATE, 'START INSERT BSCORE_IMS_COLLAT', LOCALTIMESTAMP);
	 --COMMIT;


	 INSERT INTO BSCORE_IMS_COLLAT(BUS_CYC_DT, ACCT_NO, COAR_COLL_NO, PROP_TYP_CD)

	SELECT PROC_DT2, coar.COAR_R_ACCT_NO, coar.COAR_COLL_NO, prop.PROP_TYP_CD
	FROM  dwprod.collat_acct_rel_ht_1_prt_collat_acct_rel_ht_201102 coar, dwprod.collat_prop_ht_1_prt_collat_prop_ht_201102 prop
	WHERE coar.COAR_BUS_CYC_DT = PROC_DT2
	AND coar.COAR_R_APPL_SYS_ID ='IMS'
	AND coar.COAR_COLL_NO = prop.PROP_COLL_NO;

--commit;

	 INSERT INTO BSCORE_LOG_IMS(SYS_ID, BUS_CYC_DT, PROCESS_MSG, PROC_DT)
	 VALUES ('IMS', RUN_DATE, 'END INSERT BSCORE_IMS_COLLAT', LOCALTIMESTAMP);
	-- COMMIT;

END;
$$
LANGUAGE PLPGSQL;

